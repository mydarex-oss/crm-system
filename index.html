<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Darex SalesPulse - Sales & CRM Platform</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='80' font-size='80' fill='%234A90E2'>D</text></svg>">
    
    <!-- React and Chart.js -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom-client.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Zoho-like colors */
            --sidebar-bg: #2E3D59;
            --sidebar-hover: #3A4D6A;
            --sidebar-active: #4A90E2;
            --primary: #4A90E2;
            --primary-dark: #357ABD;
            --success: #5CB85C;
            --warning: #F0AD4E;
            --danger: #D9534F;
            --info: #5BC0DE;
            
            --white: #FFFFFF;
            --gray-50: #F8F9FA;
            --gray-100: #F1F3F5;
            --gray-200: #E9ECEF;
            --gray-300: #DEE2E6;
            --gray-400: #CED4DA;
            --gray-500: #ADB5BD;
            --gray-600: #6C757D;
            --gray-700: #495057;
            --gray-800: #343A40;
            --gray-900: #212529;
            
            --text-primary: #212529;
            --text-secondary: #6C757D;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: var(--gray-100);
            color: var(--text-primary);
        }

        /* V4 MODERN LOGIN */
        .login-container { display: flex; align-items: center; justify-content: center; min-height: 100vh; background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%); position: relative; overflow: hidden; }
        .login-container::before { content: ''; position: absolute; width: 200%; height: 200%; background-image: radial-gradient(circle, rgba(255,255,255,0.05) 1px, transparent 1px); background-size: 30px 30px; animation: backgroundMove 30s linear infinite; }
        @keyframes backgroundMove { 0% { transform: translate(0, 0); } 100% { transform: translate(-50%, -50%); } }
        .login-split { display: flex; width: 100%; max-width: 1100px; margin: 20px; background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.3); position: relative; z-index: 1; }
        .login-left { flex: 1; padding: 60px; background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: white; display: flex; flex-direction: column; justify-content: center; align-items: flex-start; text-align: left; }
        .login-left h2 { font-size: 36px; margin-bottom: 16px; font-weight: 700; line-height: 1.2; max-width: 400px; }
        .login-left p { font-size: 17px; opacity: 0.9; line-height: 1.7; margin-bottom: 40px; max-width: 400px; }
        .login-illustration { width: 100%; max-width: 350px; margin: 0 0 30px 0; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-20px); } }
        .feature-list { text-align: left; margin-top: 30px; width: 100%; max-width: 400px; }
        .feature-item { display: flex; align-items: center; gap: 14px; margin-bottom: 14px; font-size: 15px; font-weight: 500; }
        .feature-item::before { content: '‚úì'; background: rgba(74, 144, 226, 0.3); width: 26px; height: 26px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; }
        .login-right { flex: 1; padding: 60px; display: flex; flex-direction: column; justify-content: center; }
        .login-header { margin-bottom: 40px; }
        .login-header h1 { font-size: 28px; color: #2E3D59; margin-bottom: 8px; }
        .login-header p { color: #6C757D; font-size: 14px; }
        .login-footer { margin-top: 24px; text-align: center; font-size: 13px; color: #6C757D; }
        .forgot-password-link { color: #4A90E2; text-decoration: none; font-weight: 500; cursor: pointer; transition: all 0.2s; }
        .forgot-password-link:hover { text-decoration: underline; color: #357ABD; }
        .back-link { display: inline-flex; align-items: center; gap: 6px; color: #4A90E2; text-decoration: none; font-weight: 500; margin-bottom: 20px; cursor: pointer; transition: all 0.2s; }
        .back-link:hover { gap: 8px; color: #357ABD; }
        .otp-input { text-align: center; font-size: 24px; letter-spacing: 8px; font-weight: 600; }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 16px;
        }

        .form-input, select, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--gray-300);
            border-radius: 4px;
            font-size: 14px;
            transition: all 0.2s;
        }

        .form-input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }

        .password-wrapper {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: var(--gray-500);
        }

        textarea {
            min-height: 80px;
            resize: vertical;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: var(--gray-200);
            color: var(--gray-700);
        }

        .btn-secondary:hover {
            background: var(--gray-300);
        }

        .btn-success {
            background: var(--success);
            color: var(--white);
        }

        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
        }

        .btn-icon {
            padding: 8px;
            background: transparent;
            color: var(--gray-600);
        }

        .btn-icon:hover {
            background: var(--gray-100);
            color: var(--primary);
        }

        /* Dashboard Layout */
        .dashboard {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 240px;
            background: var(--sidebar-bg);
            color: var(--white);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 4px;
        }

        .sidebar-logo-icon {
            width: 32px;
            height: 32px;
            background: var(--primary);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
        }

        .sidebar-logo h2 {
            font-size: 18px;
            font-weight: 600;
        }

        .sidebar-logo p {
            font-size: 11px;
            opacity: 0.7;
        }

        .nav-menu {
            list-style: none;
            padding: 10px;
            flex: 1;
        }

        .nav-section {
            margin-bottom: 20px;
        }

        .nav-section-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.5;
            margin: 16px 12px 8px;
        }

        .nav-item {
            margin-bottom: 2px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            border-radius: 4px;
            transition: all 0.2s;
            font-size: 14px;
            cursor: pointer;
        }

        .nav-link:hover {
            background: var(--sidebar-hover);
            color: var(--white);
        }

        .nav-link.active {
            background: var(--sidebar-active);
            color: var(--white);
        }

        .nav-icon {
            width: 18px;
            height: 18px;
        }

        .user-section {
            padding: 16px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .user-card {
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .user-name {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .user-role {
            font-size: 12px;
            opacity: 0.7;
        }

        /* Main Content */
        .main-content {
            margin-left: 240px;
            flex: 1;
            min-height: 100vh;
            background: var(--gray-50);
        }

        .top-bar {
            background: var(--white);
            border-bottom: 1px solid var(--gray-200);
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .top-bar-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .top-bar-left h1 {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .top-bar-right {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .content-area {
            padding: 24px;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--white);
            border-radius: 6px;
            padding: 20px;
            border: 1px solid var(--gray-200);
            transition: all 0.2s;
        }

        .stat-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transform: translateY(-2px);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .stat-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .stat-badge.new {
            background: rgba(74, 144, 226, 0.1);
            color: var(--primary);
        }

        .stat-value {
            font-size: 28px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .stat-footer {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
        }

        .stat-change {
            font-weight: 600;
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--danger);
        }

        .stat-subtext {
            color: var(--text-secondary);
        }

        /* Charts */
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .chart-card {
            background: var(--white);
            border-radius: 6px;
            padding: 20px;
            border: 1px solid var(--gray-200);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .chart-filter {
            padding: 6px 12px;
            border: 1px solid var(--gray-300);
            border-radius: 4px;
            font-size: 12px;
            background: var(--white);
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Table */
        .table-card {
            background: var(--white);
            border-radius: 6px;
            border: 1px solid var(--gray-200);
            overflow: hidden;
            margin-bottom: 24px;
        }

        .table-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 16px;
            font-weight: 600;
        }

        .table-actions {
            display: flex;
            gap: 8px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: var(--gray-50);
        }

        th {
            padding: 12px 20px;
            text-align: left;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--gray-200);
        }

        td {
            padding: 14px 20px;
            border-bottom: 1px solid var(--gray-100);
            font-size: 14px;
        }

        tbody tr:hover {
            background: var(--gray-50);
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: capitalize;
        }

        .badge-new { background: rgba(74, 144, 226, 0.1); color: var(--primary); }
        .badge-contacted { background: rgba(91, 192, 222, 0.1); color: var(--info); }
        .badge-qualified { background: rgba(92, 184, 92, 0.1); color: var(--success); }
        .badge-won { background: rgba(92, 184, 92, 0.2); color: var(--success); }
        .badge-lost { background: rgba(217, 83, 79, 0.1); color: var(--danger); }
        .badge-pending { background: rgba(240, 173, 78, 0.1); color: var(--warning); }
        .badge-completed { background: rgba(92, 184, 92, 0.1); color: var(--success); }
        .badge-cancelled { background: rgba(217, 83, 79, 0.1); color: var(--danger); }
        .badge-high { background: rgba(217, 83, 79, 0.1); color: var(--danger); }
        .badge-medium { background: rgba(240, 173, 78, 0.1); color: var(--warning); }
        .badge-low { background: rgba(91, 192, 222, 0.1); color: var(--info); }
        .badge-successful { background: rgba(92, 184, 92, 0.1); color: var(--success); }
        .badge-failed { background: rgba(217, 83, 79, 0.1); color: var(--danger); }
        .badge-followup { background: rgba(240, 173, 78, 0.1); color: var(--warning); }
        .badge-call { background: rgba(74, 144, 226, 0.1); color: var(--primary); }
        .badge-meeting { background: rgba(92, 184, 92, 0.1); color: var(--success); }
        .badge-email { background: rgba(240, 173, 78, 0.1); color: var(--warning); }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal {
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            background: var(--white);
            border-radius: 6px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--gray-400);
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
        }

        .close-btn:hover {
            color: var(--gray-700);
        }

        /* Toast */
        .toast-container {
            position: fixed;
            top: 70px;
            right: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            padding: 14px 18px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            background: var(--white);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            animation: slideIn 0.3s;
            border-left: 4px solid;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast-success { border-left-color: var(--success); }
        .toast-error { border-left-color: var(--danger); }
        .toast-info { border-left-color: var(--primary); }

        .toast-message {
            flex: 1;
            font-size: 14px;
            font-weight: 500;
        }

        /* Icons */
        .icon {
            width: 18px;
            height: 18px;
        }

        .icon-sm { width: 14px; height: 14px; }
        .icon-lg { width: 24px; height: 24px; }

        /* Alert */
        .alert {
            padding: 12px 16px;
            border-radius: 4px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-error {
            background: rgba(217, 83, 79, 0.1);
            color: var(--danger);
            border: 1px solid rgba(217, 83, 79, 0.2);
        }

        .alert-info {
            background: rgba(74, 144, 226, 0.1);
            color: var(--primary);
            border: 1px solid rgba(74, 144, 226, 0.2);
        }

        .alert-success {
            background: rgba(92, 184, 92, 0.1);
            color: var(--success);
            border: 1px solid rgba(92, 184, 92, 0.2);
        }


        /* Loading */
        .spinner {
            border: 3px solid var(--gray-200);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 40px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-text {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        /* Search */
        .search-bar {
            position: relative;
            flex: 1;
            max-width: 400px;
        }

        .search-input {
            width: 100%;
            padding: 8px 12px 8px 36px;
            border: 1px solid var(--gray-300);
            border-radius: 4px;
            font-size: 14px;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-400);
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--gray-200);
        }

        .tab {
            padding: 10px 16px;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            color: var(--text-secondary);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: -2px;
        }

        .tab:hover {
            color: var(--primary);
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        /* Mobile Menu Toggle */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            padding: 8px;
            cursor: pointer;
            color: var(--gray-700);
        }

        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 998;
        }

        .mobile-overlay.active {
            display: block;
        }

// Lead Stages Configuration
const LEAD_STAGES = [
    { name: 'New', color: '#4A90E2', icon: '‚ú®' },
    { name: 'Contacted', color: '#5BC0DE', icon: 'üìû' },
    { name: 'Qualified', color: '#5CB85C', icon: '‚úÖ' },
    { name: 'Proposal Sent', color: '#F0AD4E', icon: 'üìÑ' },
    { name: 'Negotiation', color: '#E8A15D', icon: 'üí¨' },
    { name: 'Won', color: '#5CB85C', icon: 'üéâ' },
    { name: 'Lost', color: '#D9534F', icon: '‚ùå' }
];

        
        /* Responsive Styles */
        
        /* Tablet View (768px - 1024px) */
        @media (max-width: 1024px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .chart-grid {
                grid-template-columns: 1fr;
            }

            .table-actions {
                flex-wrap: wrap;
            }
        }

        /* Mobile View (Below 768px) */
        @media (max-width: 768px) {
            /* Hide sidebar by default on mobile */
            .sidebar {
                position: fixed;
                left: -240px;
                transition: left 0.3s ease;
                z-index: 999;
                width: 240px;
            }

            .sidebar.active {
                left: 0;
                box-shadow: 2px 0 8px rgba(0,0,0,0.2);
            }

            /* Remove left margin on mobile */
            .main-content {
                margin-left: 0;
            }

            /* Show mobile menu button */
            .mobile-menu-btn {
                display: block;
            }

            /* Top bar adjustments */
            .top-bar {
                padding: 12px 16px;
            }

            .top-bar-left h1 {
                font-size: 18px;
            }

            .top-bar-right {
                gap: 8px;
            }

            /* Content area */
            .content-area {
                padding: 16px;
            }

            /* Stats grid - single column */
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .stat-card {
                padding: 16px;
            }

            .stat-value {
                font-size: 24px;
            }

            /* Charts */
            .chart-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .chart-card {
                padding: 16px;
            }

            .chart-container {
                height: 250px;
            }

            /* Tables - make scrollable */
            .table-card {
                overflow-x: auto;
            }

            table {
                min-width: 600px;
            }

            th, td {
                padding: 10px 12px;
                font-size: 13px;
            }

            .table-header {
                padding: 12px 16px;
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .table-actions {
                width: 100%;
                justify-content: flex-start;
            }

            /* Modals */
            .modal-content {
                width: 95%;
                max-width: 95%;
                margin: 20px auto;
                max-height: 90vh;
                overflow-y: auto;
            }

            .modal-header {
                padding: 16px;
            }

            .modal-body {
                padding: 16px;
            }

            .modal-footer {
                padding: 16px;
                flex-direction: column-reverse;
                gap: 8px;
            }

            .modal-footer .btn {
                width: 100%;
                justify-content: center;
            }

            /* Forms */
            .form-row {
                grid-template-columns: 1fr !important;
            }

            /* Toast notifications */
            .toast-container {
                top: 60px;
                right: 10px;
                left: 10px;
            }

            .toast {
                min-width: auto;
                width: 100%;
            }

            /* Login page mobile */
            .login-split {
                flex-direction: column;
                margin: 10px;
            }

            .login-left {
                padding: 40px 30px;
                text-align: center;
                align-items: center;
            }

            .login-left h2 {
                font-size: 28px;
            }

            .login-left p {
                font-size: 15px;
            }

            .login-illustration {
                max-width: 250px;
            }

            .feature-list {
                align-items: center;
            }

            .login-right {
                padding: 40px 30px;
            }

            .login-header h1 {
                font-size: 24px;
            }

            /* Search bar */
            .search-bar {
                max-width: 100%;
            }

            /* Badges */
            .badge {
                font-size: 11px;
                padding: 3px 8px;
            }

            /* Buttons - stack on mobile when in groups */
            .btn-group {
                flex-direction: column;
                width: 100%;
            }

            .btn-group .btn {
                width: 100%;
            }
        }

        /* Small Mobile (Below 480px) */
        @media (max-width: 480px) {
            .top-bar-left h1 {
                font-size: 16px;
            }

            .stat-value {
                font-size: 20px;
            }

            .chart-container {
                height: 200px;
            }

            .login-left {
                padding: 30px 20px;
            }

            .login-right {
                padding: 30px 20px;
            }

            .login-left h2 {
                font-size: 24px;
            }

            .login-illustration {
                max-width: 200px;
            }

            .modal-header h2 {
                font-size: 18px;
            }

            th, td {
                font-size: 12px;
                padding: 8px;
            }

            .btn {
                padding: 8px 16px;
                font-size: 13px;
            }

            .content-area {
                padding: 12px;
            }
        }

        /* Landscape phone orientation fix */
        @media (max-height: 500px) and (orientation: landscape) {
            .login-container {
                min-height: auto;
                padding: 20px 0;
            }

            .login-split {
                max-height: 90vh;
                overflow-y: auto;
            }

            .login-left {
                padding: 30px;
            }

            .login-illustration {
                max-width: 180px;
            }
        }

        /* Print styles */
        @media print {
            .sidebar,
            .top-bar-right,
            .table-actions,
            .modal-footer,
            .toast-container {
                display: none !important;
            }

            .main-content {
                margin-left: 0;
            }

            .table-card,
            .chart-card,
            .stat-card {
                break-inside: avoid;
            }
        }
.view-toggle {
    display: flex;
    gap: 8px;
    background: var(--gray-100);
    padding: 4px;
    border-radius: 4px;
}

.view-toggle button {
    padding: 6px 12px;
    background: transparent;
    border: none;
    border-radius: 3px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 500;
    color: var(--text-secondary);
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
}

.view-toggle button.active {
    background: var(--white);
    color: var(--primary);
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 20px;
    padding: 20px;
}

.activity-card, .followup-card {
    background: var(--white);
    border: 1px solid var(--gray-200);
    border-radius: 6px;
    padding: 20px;
    transition: all 0.2s;
}

.activity-card:hover, .followup-card:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    transform: translateY(-2px);
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 16px;
}

.card-title {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 4px;
}

.card-subtitle {
    font-size: 13px;
    color: var(--text-secondary);
}

.card-actions {
    display: flex;
    gap: 4px;
}

.card-body {
    margin-bottom: 16px;
}

.card-detail {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid var(--gray-100);
    font-size: 14px;
}

.card-detail:last-child {
    border-bottom: none;
}

.card-detail-label {
    color: var(--text-secondary);
    font-weight: 500;
}

@media (max-width: 768px) {
    .cards-grid {
        grid-template-columns: 1fr;
    }
}
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Configuration
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwZBjZvRFKMYovqgKA9TKMalZ5DSnsdIr6WmsgfSbHXMYkLriQ5johO8nn0dqTzNL7mRA/exec';
        const SESSION_TIMEOUT = 24 * 60 * 60 * 1000;
        const AUTO_REFRESH_INTERVAL = 30000;

        // Session Management
        const SessionManager = {
            setSession: (user) => {
                const sessionData = {
                    user,
                    loginTime: Date.now(),
                    lastActivity: Date.now()
                };
                localStorage.setItem('session', JSON.stringify(sessionData));
            },
            
            getSession: () => {
                const session = localStorage.getItem('session');
                if (!session) return null;
                
                const sessionData = JSON.parse(session);
                const now = Date.now();
                
                if (now - sessionData.loginTime > SESSION_TIMEOUT) {
                    SessionManager.clearSession();
                    return null;
                }
                
                sessionData.lastActivity = now;
                localStorage.setItem('session', JSON.stringify(sessionData));
                
                return sessionData.user;
            },
            
            clearSession: () => {
                localStorage.removeItem('session');
            },
            
            updateActivity: () => {
                const session = localStorage.getItem('session');
                if (session) {
                    const sessionData = JSON.parse(session);
                    sessionData.lastActivity = Date.now();
                    localStorage.setItem('session', JSON.stringify(sessionData));
                }
            }
        };

        // Icons
        const Icons = {
            Eye: () => (
                <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                </svg>
            ),
            EyeOff: () => (
                <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21" />
                </svg>
            ),
            Home: () => (
                <svg className="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                </svg>
            ),
            Leads: () => (
                <svg className="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
            ),
            Activity: () => (
                <svg className="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                </svg>
            ),
            Calendar: () => (
                <svg className="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
            ),
            Chart: () => (
                <svg className="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                </svg>
            ),
            Team: () => (
                <svg className="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                </svg>
            ),
            Settings: () => (
                <svg className="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
            ),
            Plus: () => (
                <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                </svg>
            ),
            Refresh: () => (
                <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
            ),
            CheckCircle: () => (
                <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            ),
            XCircle: () => (
                <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            ),
            InfoCircle: () => (
                <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            ),
            Search: () => (
                <svg className="icon search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
            ),
            Edit: () => (
                <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                </svg>
            ),
            Dollar: () => (
                <svg className="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            ),

            Grid: () => (
    <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
    </svg>
),
List: () => (
    <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 10h16M4 14h16M4 18h16" />
    </svg>
),
Trash: () => (
    <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
    </svg>
),
            User: () => (
                <svg className="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
            ),
        };

        // API Service
class AppsScriptAPI {
    constructor(baseUrl) {
        this.baseUrl = baseUrl;
    }

    async get(action, params = {}) {
        try {
            const url = new URL(this.baseUrl);
            url.searchParams.append('action', action);
            Object.keys(params).forEach(key => {
                if (params[key] !== undefined && params[key] !== null) {
                    url.searchParams.append(key, params[key]);
                }
            });

            const response = await fetch(url.toString());
            const data = await response.json();
            
            if (!data.success) {
                throw new Error(data.error || 'API request failed');
            }
            
            return data;
        } catch (error) {
            throw new Error(error.message || 'Network error');
        }
    }

    async post(action, data) {
        try {
            const url = `${this.baseUrl}?action=${action}`;
            const response = await fetch(url, {
                method: 'POST',
                body: JSON.stringify(data)
            });
            
            const result = await response.json();
            
            if (!result.success) {
                throw new Error(result.error || 'API request failed');
            }
            
            return result;
        } catch (error) {
            throw new Error(error.message || 'Network error');
        }
    }

    // Authentication
    authenticate(username, password) {
        return this.get('authenticate', { username, password });
    }

    // Leads
    getLeads() {
        return this.get('getLeads');
    }

    addLead(data) {
        return this.post('addLead', data);
    }

    updateLead(data) {
        return this.post('updateLead', data);
    }

    assignLead(leadId, assignedTo) {
        return this.post('assignLead', { leadId, assignedTo });
    }

    updateLeadStage(leadId, status) {
        return this.post('updateLeadStage', { leadId, status });
    }

    convertLeadToCustomer(leadId, createdBy) {
        return this.post('convertLeadToCustomer', { leadId, createdBy });
    }

    // Customers (NEW)
    getCustomers() {
        return this.get('getCustomers');
    }

    addCustomer(data) {
        return this.post('addCustomer', data);
    }

    updateCustomer(data) {
        return this.post('updateCustomer', data);
    }

    // Activities
    getActivities() {
        return this.get('getActivities');
    }

    addActivity(data) {
        return this.post('addActivity', data);
    }

    assignActivity(activityId, assignedTo) {
        return this.post('assignActivity', { activityId, assignedTo });
    }

    // Follow-ups
    getFollowUps() {
        return this.get('getFollowUps');
    }

    addFollowUp(data) {
        return this.post('addFollowUp', data);
    }

    updateFollowUp(data) {
        return this.post('updateFollowUp', data);
    }

    assignFollowUp(followUpId, assignedTo) {
        return this.post('assignFollowUp', { followUpId, assignedTo });
    }

    // Delete operations
deleteLead(data) {
    return this.post('deleteLead', data);
}

deleteCustomer(data) {
    return this.post('deleteCustomer', data);
}

deleteActivity(data) {
    return this.post('deleteActivity', data);
}

deleteFollowUp(data) {
    return this.post('deleteFollowUp', data);
}

updateActivity(data) {
    return this.post('updateActivity', data);
}

    // Users
    getUsersList() {
        return this.get('getUsersList');
    }

    getUserProfile(username) {
        return this.get('getUserProfile', { username });
    }

    updateUserProfile(data) {
        return this.post('updateProfile', data);
    }

    changePassword(data) {
        return this.post('changePassword', data);
    }

    // Team
    getTeamPerformance() {
        return this.get('getTeamPerformance');
    }

    // Login History
    getLoginHistory(username) {
        return this.get('getLoginHistory', { username });
    }

    // Password Reset
    requestPasswordReset(data) {
        return this.post('requestPasswordReset', data);
    }

    verifyOTP(email, otp) {
        return this.get('verifyOTP', { email, otp });
    }

    resetPassword(data) {
        return this.post('resetPassword', data);
    }

    // Config
    getConfig() {
        return this.get('getConfig');
    }
}

        const api = new AppsScriptAPI(APPS_SCRIPT_URL);

        // Toast Component
        const Toast = ({ message, type, onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 4000);
                return () => clearTimeout(timer);
            }, [onClose]);

            const iconMap = {
                success: <Icons.CheckCircle />,
                error: <Icons.XCircle />,
                info: <Icons.InfoCircle />
            };

            return (
                <div className={`toast toast-${type}`}>
                    {iconMap[type]}
                    <span className="toast-message">{message}</span>
                </div>
            );
        };

        const ToastContainer = ({ toasts, removeToast }) => (
            <div className="toast-container">
                {toasts.map(toast => (
                    <Toast key={toast.id} message={toast.message} type={toast.type} onClose={() => removeToast(toast.id)} />
                ))}
            </div>
        );

        // Date formatting helper
const formatDateTime = (dateString) => {
    if (!dateString) return 'N/A';
    try {
        const date = new Date(dateString);
        if (isNaN(date.getTime())) return 'N/A';
        
        return date.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
    } catch (error) {
        return 'N/A';
    }
};

const formatDate = (dateString) => {
    if (!dateString) return 'N/A';
    try {
        const date = new Date(dateString);
        if (isNaN(date.getTime())) return 'N/A';
        
        return date.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
        });
    } catch (error) {
        return 'N/A';
    }
};

        // ForgotPassword Component (V4)
        const ForgotPassword = ({ onBack, showToast }) => {
            const [step, setStep] = useState('email');
            const [email, setEmail] = useState('');
            const [otp, setOtp] = useState('');
            const [newPassword, setNewPassword] = useState('');
            const [confirmPassword, setConfirmPassword] = useState('');
            const [loading, setLoading] = useState(false);

            const handleSendOTP = async (e) => {
                e.preventDefault();
                setLoading(true);
                try {
                    await api.sendPasswordResetOTP({ email });
                    showToast('OTP sent to your email! Check spam if not in inbox.', 'success');
                    setStep('otp');
                } catch (error) {
                    showToast(error.message, 'error');
                } finally {
                    setLoading(false);
                }
            };

            const handleVerifyOTP = (e) => {
                e.preventDefault();
                if (otp.length === 6) {
                    setStep('password');
                } else {
                    showToast('Please enter a valid 6-digit OTP', 'error');
                }
            };

            const handleResetPassword = async (e) => {
                e.preventDefault();
                if (newPassword !== confirmPassword) {
                    showToast('Passwords do not match', 'error');
                    return;
                }
                if (newPassword.length < 6) {
                    showToast('Password must be at least 6 characters', 'error');
                    return;
                }
                setLoading(true);
                try {
                    await api.resetPasswordWithOTP({ email, otp, newPassword });
                    showToast('Password reset successfully! Please login with your new password.', 'success');
                    setTimeout(() => onBack(), 2000);
                } catch (error) {
                    showToast(error.message, 'error');
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="login-container">
                    <div className="login-split" style={{ maxWidth: '600px' }}>
                        <div className="login-right" style={{ flex: 'none', width: '100%' }}>
                            <div className="login-header">
                                <span className="back-link" onClick={onBack}>‚Üê Back to Login</span>
                                <h1>Reset Password</h1>
                                <p>{step === 'email' ? 'Enter your email to receive OTP' : step === 'otp' ? 'Enter the 6-digit code sent to your email' : 'Create a new password'}</p>
                            </div>

                            {step === 'email' && (
                                <form onSubmit={handleSendOTP}>
                                    <div className="form-group">
                                        <label className="form-label">Email Address *</label>
                                        <input type="email" className="form-input" value={email} onChange={(e) => setEmail(e.target.value)} placeholder="Enter your registered email" required />
                                    </div>
                                    <button type="submit" className="btn btn-primary" style={{ width: '100%' }} disabled={loading}>
                                        {loading ? 'Sending OTP...' : 'Send OTP'}
                                    </button>
                                </form>
                            )}

                            {step === 'otp' && (
                                <form onSubmit={handleVerifyOTP}>
                                    <div className="alert alert-info">
                                        <Icons.InfoCircle />
                                        OTP sent to <strong>{email}</strong>. Check spam folder if not in inbox.
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">Enter 6-Digit OTP *</label>
                                        <input type="text" className="form-input otp-input" value={otp} onChange={(e) => setOtp(e.target.value.replace(/\D/g, '').slice(0, 6))} placeholder="000000" maxLength="6" required />
                                    </div>
                                    <button type="submit" className="btn btn-primary" style={{ width: '100%', marginBottom: '10px' }}>Verify OTP</button>
                                    <button type="button" className="btn btn-secondary" style={{ width: '100%' }} onClick={() => setStep('email')}>Resend OTP</button>
                                </form>
                            )}

                            {step === 'password' && (
                                <form onSubmit={handleResetPassword}>
                                    <div className="alert alert-success">
                                        <Icons.CheckCircle />
                                        OTP verified! Create your new password below.
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">New Password *</label>
                                        <input type="password" className="form-input" value={newPassword} onChange={(e) => setNewPassword(e.target.value)} placeholder="Enter new password (min 6 characters)" required />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">Confirm Password *</label>
                                        <input type="password" className="form-input" value={confirmPassword} onChange={(e) => setConfirmPassword(e.target.value)} placeholder="Confirm new password" required />
                                    </div>
                                    <button type="submit" className="btn btn-primary" style={{ width: '100%' }} disabled={loading}>
                                        {loading ? 'Resetting Password...' : 'Reset Password'}
                                    </button>
                                </form>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // Login Component (V4 MODERN)
        const Login = ({ onLogin }) => {
            const [showForgotPassword, setShowForgotPassword] = useState(false);
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [showPassword, setShowPassword] = useState(false);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [toasts, setToasts] = useState([]);

            const showToast = (message, type = 'info') => {
                const id = Date.now();
                setToasts(prev => [...prev, { id, message, type }]);
            };

            const removeToast = (id) => {
                setToasts(prev => prev.filter(t => t.id !== id));
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                setError('');
                try {
                    const result = await api.authenticate(username, password);
                    SessionManager.setSession(result.user);
                    onLogin(result.user);
                } catch (err) {
                    setError(err.message || 'Invalid credentials');
                } finally {
                    setLoading(false);
                }
            };

            if (showForgotPassword) {
                return <ForgotPassword onBack={() => setShowForgotPassword(false)} showToast={showToast} />;
            }

            return (
                <>
                    <div className="login-container">
                        <div className="login-split">
                            <div className="login-left">
                                <div className="login-illustration">
                                    <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" style={{ width: '140px', height: '140px', marginBottom: '40px' }}>
                                        <circle cx="100" cy="100" r="90" fill="rgba(74, 144, 226, 0.15)" stroke="rgba(74, 144, 226, 0.3)" strokeWidth="2"/>
                                        <path d="M70 100 L90 120 L130 70" stroke="rgba(74, 144, 226, 0.8)" strokeWidth="8" fill="none" strokeLinecap="round" strokeLinejoin="round"/>
                                    </svg>
                                </div>
                                <h2>Sales CRM Made Simple</h2>
                                <p>Manage your leads, track activities, and close more deals with our powerful, easy-to-use CRM platform.</p>
                                <div className="feature-list">
                                    <div className="feature-item">Manage leads efficiently</div>
                                    <div className="feature-item">Track activities & follow-ups</div>
                                    <div className="feature-item">Real-time analytics</div>
                                    <div className="feature-item">Team performance metrics</div>
                                </div>
                            </div>
                            
                            <div className="login-right">
                                <div className="login-header">
                                    <h1>Sign In</h1>
                                    <p>Enter your credentials to access your account</p>
                                </div>
                                
                                <form onSubmit={handleSubmit}>
                                    <div className="form-group">
                                        <label className="form-label">Username</label>
                                        <input type="text" className="form-input" value={username} onChange={(e) => setUsername(e.target.value)} placeholder="Enter username" required />
                                    </div>
                                    
                                    <div className="form-group">
                                        <label className="form-label">Password</label>
                                        <div className="password-wrapper">
                                            <input type={showPassword ? "text" : "password"} className="form-input" value={password} onChange={(e) => setPassword(e.target.value)} placeholder="Enter password" required style={{ paddingRight: '40px' }} />
                                            <button type="button" className="password-toggle" onClick={() => setShowPassword(!showPassword)}>
                                                {showPassword ? <Icons.EyeOff /> : <Icons.Eye />}
                                            </button>
                                        </div>
                                    </div>

                                    {error && <div className="alert alert-error"><Icons.XCircle />{error}</div>}
                                    
                                    <button type="submit" className="btn btn-primary" style={{ width: '100%' }} disabled={loading}>
                                        {loading ? 'Signing in...' : 'Sign In'}
                                    </button>

                                    <div className="login-footer">
                                        <a className="forgot-password-link" onClick={() => setShowForgotPassword(true)}>Forgot Password?</a>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <ToastContainer toasts={toasts} removeToast={removeToast} />
                </>
            );
        };

        
        // ========== PROFILE VIEW COMPONENT (V4) ==========
        const ProfileView = ({ user, showToast, onRefresh }) => {
            const [editing, setEditing] = useState(false);
            const [changingPassword, setChangingPassword] = useState(false);
            const [loginHistory, setLoginHistory] = useState([]);
            const [loading, setLoading] = useState(true);
            const [formData, setFormData] = useState({
                fullName: user.fullName,
                email: user.email,
                phone: user.phone || '',
                department: user.department || ''
            });
            const [passwordData, setPasswordData] = useState({
                currentPassword: '',
                newPassword: '',
                confirmPassword: ''
            });

            useEffect(() => {
                loadLoginHistory();
            }, []);

            const loadLoginHistory = async () => {
                try {
                    setLoading(true);
                    const result = await api.getLoginHistory(user.username);
                    setLoginHistory(result.history || []);
                } catch (error) {
                    showToast(error.message, 'error');
                } finally {
                    setLoading(false);
                }
            };

            const handleUpdateProfile = async (e) => {
                e.preventDefault();
                try {
                    await api.updateProfile({
                        username: user.username,
                        ...formData
                    });
                    showToast('Profile updated successfully', 'success');
                    setEditing(false);
                    onRefresh();
                } catch (error) {
                    showToast(error.message, 'error');
                }
            };

            const handleChangePassword = async (e) => {
                e.preventDefault();
                
                if (passwordData.newPassword !== passwordData.confirmPassword) {
                    showToast('Passwords do not match', 'error');
                    return;
                }
                
                if (passwordData.newPassword.length < 6) {
                    showToast('Password must be at least 6 characters', 'error');
                    return;
                }

                try {
                    await api.changePassword({
                        username: user.username,
                        currentPassword: passwordData.currentPassword,
                        newPassword: passwordData.newPassword
                    });
                    showToast('Password changed successfully!', 'success');
                    setChangingPassword(false);
                    setPasswordData({ currentPassword: '', newPassword: '', confirmPassword: '' });
                } catch (error) {
                    showToast(error.message, 'error');
                }
            };

            return (
                <>
                    <div className="stats-grid">
                        <div className="stat-card" style={{ gridColumn: 'span 2' }}>
                            <div className="profile-header">
                                <div className="profile-avatar">
                                    <div className="avatar-placeholder">
                                        {user.fullName.charAt(0).toUpperCase()}
                                    </div>
                                </div>
                                <div className="profile-info">
                                    <h2>{user.fullName}</h2>
                                    <p>@{user.username}</p>
                                    <span className={`badge badge-${user.role}`}>{user.role}</span>
                                </div>
                                <button className="btn btn-primary btn-sm" onClick={() => setEditing(!editing)}>
                                    <Icons.Edit /> {editing ? 'Cancel' : 'Edit Profile'}
                                </button>
                            </div>

                            {editing ? (
                                <form onSubmit={handleUpdateProfile} style={{ marginTop: '24px' }}>
                                    <div className="form-group">
                                        <label className="form-label">Full Name</label>
                                        <input type="text" className="form-input" value={formData.fullName} onChange={(e) => setFormData({...formData, fullName: e.target.value})} />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">Email</label>
                                        <input type="email" className="form-input" value={formData.email} onChange={(e) => setFormData({...formData, email: e.target.value})} />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">Phone</label>
                                        <input type="tel" className="form-input" value={formData.phone} onChange={(e) => setFormData({...formData, phone: e.target.value})} />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">Department</label>
                                        <input type="text" className="form-input" value={formData.department} onChange={(e) => setFormData({...formData, department: e.target.value})} />
                                    </div>
                                    <button type="submit" className="btn btn-primary">Save Changes</button>
                                </form>
                            ) : (
                                <div style={{ marginTop: '24px' }}>
                                    <div className="profile-detail"><span>Email:</span> {user.email}</div>
                                    <div className="profile-detail"><span>Phone:</span> {user.phone || 'Not set'}</div>
                                    <div className="profile-detail"><span>Department:</span> {user.department || 'Not set'}</div>
                                    <div className="profile-detail"><span>Role:</span> <span className={`badge badge-${user.role}`}>{user.role}</span></div>
                                </div>
                            )}
                        </div>

                        <div className="stat-card">
                            <h3 style={{ marginBottom: '16px' }}>Security</h3>
                            {!changingPassword ? (
                                <>
                                    <p style={{ fontSize: '14px', color: 'var(--text-secondary)', marginBottom: '16px' }}>Keep your account secure</p>
                                    <button className="btn btn-secondary" onClick={() => setChangingPassword(true)}>Change Password</button>
                                </>
                            ) : (
                                <form onSubmit={handleChangePassword}>
                                    <div className="form-group">
                                        <label className="form-label">Current Password</label>
                                        <input type="password" className="form-input" value={passwordData.currentPassword} onChange={(e) => setPasswordData({...passwordData, currentPassword: e.target.value})} required />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">New Password</label>
                                        <input type="password" className="form-input" value={passwordData.newPassword} onChange={(e) => setPasswordData({...passwordData, newPassword: e.target.value})} required />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">Confirm Password</label>
                                        <input type="password" className="form-input" value={passwordData.confirmPassword} onChange={(e) => setPasswordData({...passwordData, confirmPassword: e.target.value})} required />
                                    </div>
                                    <div style={{ display: 'flex', gap: '8px' }}>
                                        <button type="submit" className="btn btn-primary">Update</button>
                                        <button type="button" className="btn btn-secondary" onClick={() => { setChangingPassword(false); setPasswordData({ currentPassword: '', newPassword: '', confirmPassword: '' }); }}>Cancel</button>
                                    </div>
                                </form>
                            )}
                        </div>
                    </div>

                    <div className="table-card">
                        <div className="table-header">
                            <div className="table-title">Login History (Last 50)</div>
                            <button className="btn btn-icon" onClick={loadLoginHistory}><Icons.Refresh /></button>
                        </div>
                        {loading ? <div className="spinner"></div> : (
                            <table>
                                <thead><tr><th>Date</th><th>Time</th><th>Status</th><th>Session Info</th></tr></thead>
                                <tbody>
                                    {loginHistory.map((log, idx) => (
                                        <tr key={idx}>
                                            <td>{log.date}</td>
                                            <td>{log.time}</td>
                                            <td><span className={`badge badge-${log.status === 'success' ? 'successful' : 'failed'}`}>{log.status}</span></td>
                                            <td>{log.ip}</td>
                                        </tr>
                                    ))}
                                    {loginHistory.length === 0 && (
                                        <tr><td colSpan="4" className="empty-state"><div className="empty-state-text">No login history available</div></td></tr>
                                    )}
                                </tbody>
                            </table>
                        )}
                    </div>
                </>
            );
        };

        const Dashboard = ({ user, onLogout, showToast }) => {
            const [activeTab, setActiveTab] = useState('home');
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
            const [data, setData] = useState({
                leads: [],
                customers: [],
                activities: [],
                followUps: [],
                teamPerformance: [],
                users: []
            });
            const [loading, setLoading] = useState(true);

            // Close mobile menu when tab changes
            const handleTabChange = (tab) => {
                setActiveTab(tab);
                setMobileMenuOpen(false);
            };

            useEffect(() => {
                loadData();
                
                const interval = setInterval(() => {
                    loadData(true);
                }, AUTO_REFRESH_INTERVAL);

                const sessionCheck = setInterval(() => {
                    const session = SessionManager.getSession();
                    if (!session) {
                        showToast('Session expired. Please login again.', 'info');
                        onLogout();
                    }
                }, 60000);

                return () => {
                    clearInterval(interval);
                    clearInterval(sessionCheck);
                };
            }, []);

            const loadData = async (silent = false) => {
                try {
                    if (!silent) setLoading(true);
                    
              const [leads, customers, activities, followUps, teamPerf, users] = await Promise.all([
    api.getLeads().catch(() => ({ leads: [] })),
    api.getCustomers().catch(() => ({ customers: [] })),
    api.getActivities().catch(() => ({ activities: [] })),
    api.getFollowUps().catch(() => ({ followUps: [] })),
    api.getTeamPerformance().catch(() => ({ teamPerformance: [] })),
    api.getUsersList().catch(() => ({ users: [] }))
]);

               setData({
    leads: leads.leads || [],
    customers: customers.customers || [],
    activities: activities.activities || [],
    followUps: followUps.followUps || [],
    teamPerformance: teamPerf.teamPerformance || [],
    users: users.users || []
});
                    SessionManager.updateActivity();
                } catch (error) {
                    if (!silent) {
                        showToast(error.message, 'error');
                    }
                } finally {
                    if (!silent) setLoading(false);
                }
            };

            const renderContent = () => {
                if (loading) return <div className="spinner"></div>;

                switch (activeTab) {
                    case 'home':
                        return <HomeView data={data} user={user} showToast={showToast} onRefresh={loadData} />;
                    case 'leads':
                        return <LeadsView leads={data.leads} users={data.users} user={user} showToast={showToast} onRefresh={loadData} />;

                    case 'customers':
    return <CustomersView customers={data.customers} users={data.users} user={user} showToast={showToast} onRefresh={loadData} />;
                    case 'profile':
                        return <ProfileView user={user} showToast={showToast} onRefresh={loadData} />;
                    case 'activities':
                        return <ActivitiesView activities={data.activities} users={data.users} leads={data.leads} user={user} showToast={showToast} onRefresh={loadData} />;
                    case 'followups':
    return <FollowUpsView followUps={data.followUps} users={data.users} leads={data.leads} user={user} showToast={showToast} onRefresh={loadData} />;
                    case 'analytics':
                        return <AnalyticsView data={data} user={user} />;
                    case 'team':
                        return <TeamView teamPerformance={data.teamPerformance} />;
                    case 'expenses':
                        return <ExpensesView user={user} showToast={showToast} />;
                    case 'settings':
                        return <SettingsView user={user} showToast={showToast} />;
                    default:
                        return <HomeView data={data} user={user} showToast={showToast} onRefresh={loadData} />;
                }
            };

            return (
                <div className="dashboard">
                    {/* Mobile menu overlay */}
                    <div className={`mobile-overlay ${mobileMenuOpen ? 'active' : ''}`} onClick={() => setMobileMenuOpen(false)}></div>
                    
                    <div className={`sidebar ${mobileMenuOpen ? 'active' : ''}`}>
                        <div className="sidebar-header">
                            <div className="sidebar-logo">
                                <div className="sidebar-logo-icon">D</div>
                                <div>
                                    <h2>Darex SalesPulse</h2>
                                    <p>Sales Platform</p>
                                </div>
                            </div>
                        </div>

                        <ul className="nav-menu">
                            <div className="nav-section">
                                <div className="nav-section-title">Main</div>
                                <li className="nav-item">
                                    <div className={`nav-link ${activeTab === 'home' ? 'active' : ''}`} onClick={() => handleTabChange('home')}>
                                        <Icons.Home />
                                        Home
                                    </div>
                                </li>
                            </div>

                            <div className="nav-section">
                                <div className="nav-section-title">Sales</div>
                                <li className="nav-item">
                                    <div className={`nav-link ${activeTab === 'leads' ? 'active' : ''}`} onClick={() => handleTabChange('leads')}>
                                        <Icons.Leads />
                                        Leads
                                    </div>
                                </li>
                                <li className="nav-item">
        <div className={`nav-link ${activeTab === 'customers' ? 'active' : ''}`} onClick={() => handleTabChange('customers')}>
            <Icons.User />
            Customers
        </div>
    </li>
                                <li className="nav-item">
                                    <div className={`nav-link ${activeTab === 'activities' ? 'active' : ''}`} onClick={() => handleTabChange('activities')}>
                                        <Icons.Activity />
                                        Activities
                                    </div>
                                </li>
                                <li className="nav-item">
                                    <div className={`nav-link ${activeTab === 'followups' ? 'active' : ''}`} onClick={() => handleTabChange('followups')}>
                                        <Icons.Calendar />
                                        Follow-ups
                                    </div>
                                </li>
                            </div>

                            <div className="nav-section">
                                <div className="nav-section-title">Insights</div>
                                <li className="nav-item">
                                    <div className={`nav-link ${activeTab === 'analytics' ? 'active' : ''}`} onClick={() => handleTabChange('analytics')}>
                                        <Icons.Chart />
                                        Analytics
                                    </div>
                                </li>
                                <li className="nav-item">
                                    <div className={`nav-link ${activeTab === 'expenses' ? 'active' : ''}`} onClick={() => handleTabChange('expenses')}>
                                        <Icons.Dollar />
                                        Expenses
                                    </div>
                                </li>
                                <li className="nav-item">
                                    <div className={`nav-link ${activeTab === 'team' ? 'active' : ''}`} onClick={() => handleTabChange('team')}>
                                        <Icons.Team />
                                        Team
                                    </div>
                                </li>
                            </div>

                            <div className="nav-section">
                                <div className="nav-section-title">Account</div>
                                <li className="nav-item">
                                    <div className={`nav-link ${activeTab === 'profile' ? 'active' : ''}`} onClick={() => handleTabChange('profile')}>
                                        <Icons.User />
                                        My Profile
                                    </div>
                                </li>
                            </div>

                            {user.role === 'admin' && (
                                <div className="nav-section">
                                    <div className="nav-section-title">Admin</div>
                                    <li className="nav-item">
                                        <div className={`nav-link ${activeTab === 'settings' ? 'active' : ''}`} onClick={() => handleTabChange('settings')}>
                                            <Icons.Settings />
                                            Settings
                                        </div>
                                    </li>
                                </div>
                            )}
                        </ul>

                        <div className="user-section">
                            <div className="user-card">
                                <div className="user-name">{user.fullName}</div>
                                <div className="user-role">{user.role}</div>
                            </div>
                            <button className="btn btn-secondary" style={{ width: '100%' }} onClick={onLogout}>
                                Logout
                            </button>
                        </div>
                    </div>

                    <div className="main-content">
                        <div className="top-bar">
                            <div className="top-bar-left">
                                <button className="mobile-menu-btn" onClick={() => setMobileMenuOpen(!mobileMenuOpen)}>
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                        <line x1="3" y1="12" x2="21" y2="12"></line>
                                        <line x1="3" y1="6" x2="21" y2="6"></line>
                                        <line x1="3" y1="18" x2="21" y2="18"></line>
                                    </svg>
                                </button>
                                <h1>{activeTab.charAt(0).toUpperCase() + activeTab.slice(1)}</h1>
                            </div>
                            <div className="top-bar-right">
                                <div className="search-bar">
                                    <Icons.Search />
                                    <input type="text" className="search-input" placeholder="Search..." />
                                </div>
                                <button className="btn btn-icon" onClick={() => loadData()}>
                                    <Icons.Refresh />
                                </button>
                            </div>
                        </div>

                        <div className="content-area">
                            {renderContent()}
                        </div>
                    </div>
                </div>
            );
        };

        // Home View Component
        const HomeView = ({ data, user, showToast, onRefresh }) => {
            const totalRevenue = data.leads.filter(l => l.status === 'Won').reduce((sum, l) => sum + parseFloat(l.value || 0), 0);
            const activeDeals = data.leads.filter(l => l.status !== 'Won' && l.status !== 'Lost').length;
            const conversionRate = data.leads.length > 0 ? ((data.leads.filter(l => l.status === 'Won').length / data.leads.length) * 100).toFixed(1) : 0;

            useEffect(() => {
                const ctx = document.getElementById('revenueChart');
                if (ctx) {
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                            datasets: [{
                                label: 'Revenue',
                                data: [12000, 19000, 15000, 25000, 22000, 30000],
                                borderColor: '#4A90E2',
                                tension: 0.4,
                                fill: true,
                                backgroundColor: 'rgba(74, 144, 226, 0.1)'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false }
                            }
                        }
                    });
                }

                const ctx2 = document.getElementById('sourceChart');
                if (ctx2) {
                    new Chart(ctx2, {
                        type: 'doughnut',
                        data: {
                            labels: ['Website', 'Referral', 'Social', 'Direct'],
                            datasets: [{
                                data: [40, 25, 20, 15],
                                backgroundColor: ['#4A90E2', '#5CB85C', '#F0AD4E', '#D9534F']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { position: 'bottom' }
                            }
                        }
                    });
                }
            }, []);

            return (
                <>
                    <div className="stats-grid">
                        <div className="stat-card">
                            <div className="stat-header">
                                <div>
                                    <div className="stat-label">Total Revenue</div>
                                    <div className="stat-badge new">This Month</div>
                                </div>
                            </div>
                            <div className="stat-value">${totalRevenue.toLocaleString()}</div>
                            <div className="stat-footer">
                                <span className="stat-change positive">‚Üë 12%</span>
                                <span className="stat-subtext">vs last month</span>
                            </div>
                        </div>

                        <div className="stat-card">
                            <div className="stat-header">
                                <div className="stat-label">Active Deals</div>
                            </div>
                            <div className="stat-value">{activeDeals}</div>
                            <div className="stat-footer">
                                <span className="stat-change positive">‚Üë 8%</span>
                                <span className="stat-subtext">from last week</span>
                            </div>
                        </div>

                        <div className="stat-card">
                            <div className="stat-header">
                                <div className="stat-label">Conversion Rate</div>
                            </div>
                            <div className="stat-value">{conversionRate}%</div>
                            <div className="stat-footer">
                                <span className="stat-change positive">‚Üë 2.5%</span>
                                <span className="stat-subtext">improvement</span>
                            </div>
                        </div>

                        <div className="stat-card">
                            <div className="stat-header">
                                <div className="stat-label">Total Leads</div>
                            </div>
                            <div className="stat-value">{data.leads.length}</div>
                            <div className="stat-footer">
                                <span className="stat-subtext">All time</span>
                            </div>
                        </div>
                    </div>

                    <div className="chart-grid">
                        <div className="chart-card">
                            <div className="chart-header">
                                <div className="chart-title">Revenue Trend</div>
                                <select className="chart-filter">
                                    <option>Last 6 Months</option>
                                    <option>Last Year</option>
                                </select>
                            </div>
                            <div className="chart-container">
                                <canvas id="revenueChart"></canvas>
                            </div>
                        </div>

                        <div className="chart-card">
                            <div className="chart-header">
                                <div className="chart-title">Lead Sources</div>
                            </div>
                            <div className="chart-container">
                                <canvas id="sourceChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div className="table-card">
                        <div className="table-header">
                            <div className="table-title">Recent Activities</div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Activity</th>
                                    <th>Client</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {data.activities.slice(0, 5).map((activity, idx) => (
                                    <tr key={idx}>
                                        <td>{activity.type}</td>
                                        <td>{activity.clientName || activity.client_name}</td>
                                        <td>{new Date(activity.date).toLocaleDateString()}</td>
                                        <td><span className={`badge badge-${activity.outcome?.toLowerCase() || 'pending'}`}>{activity.outcome || 'Pending'}</span></td>
                                    </tr>
                                ))}
                                {data.activities.length === 0 && (
                                    <tr>
                                        <td colSpan="4" className="empty-state">
                                            <div className="empty-state-text">No activities yet</div>
                                        </td>
                                    </tr>
                                )}
                            </tbody>
                        </table>
                    </div>
                </>
            );
        };

        // LEADS VIEW - COMPLETE IMPLEMENTATION
        const LeadsView = ({ leads, users, user, showToast, onRefresh }) => {
            const [showModal, setShowModal] = useState(false);
            const [editingLead, setEditingLead] = useState(null);
            const [formData, setFormData] = useState({
                Name: '',
                Email: '',
                Phone: '',
                Company: '',
                Status: 'New',
                Source: '',
                Assignee: user.fullName,
                Notes: ''
            });
            const [saving, setSaving] = useState(false);

            const handleAdd = () => {
                setEditingLead(null);
                setFormData({
                    Name: '',
                    Email: '',
                    Phone: '',
                    Company: '',
                    Status: 'New',
                    Source: '',
                    Assignee: user.fullName,
                    Notes: ''
                });
                setShowModal(true);
            };

            const handleEdit = (lead) => {
                setEditingLead(lead);
                setFormData({
                    Name: lead.name,
                    Email: lead.email,
                    Phone: lead.phone,
                    Company: lead.company,
                    Status: lead.status,
                    Source: lead.source,
                    Assignee: lead.assignee,
                    Notes: lead.notes
                });
                setShowModal(true);
            };

           const handleSubmit = async (e) => {
    e.preventDefault();
    setSaving(true);

    // ADD THIS DELETE HANDLER
    const handleDelete = async (lead) => {
        if (!user.permissions?.delete) {
            showToast('You do not have permission to delete', 'error');
            return;
        }
        
        if (!confirm(`Delete lead "${lead.name}"?`)) return;
        
        try {
            await api.deleteLead({ id: lead.id, userRole: user.role });
            showToast('Lead deleted successfully', 'success');
            onRefresh();
        } catch (error) {
            showToast(error.message, 'error');
        }
    };

    // ADD THIS KANBAN RENDER
    const renderKanban = () => {
        const stages = ['New', 'Contacted', 'Qualified', 'Proposal Sent', 'Negotiation', 'Won', 'Lost'];
        
        return (
            <div style={{ display: 'flex', gap: '16px', overflowX: 'auto', padding: '20px' }}>
                {stages.map(stage => {
                    const stageLeads = leads.filter(l => l.status === stage);
                    return (
                        <div key={stage} style={{ minWidth: '300px', background: 'var(--gray-50)', borderRadius: '6px', padding: '16px' }}>
                            <div style={{ marginBottom: '16px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                <h3 style={{ fontSize: '14px', fontWeight: '600', textTransform: 'uppercase', letterSpacing: '0.5px' }}>
                                    {stage}
                                </h3>
                                <span style={{ background: 'var(--primary)', color: 'white', borderRadius: '12px', padding: '2px 8px', fontSize: '12px', fontWeight: '600' }}>
                                    {stageLeads.length}
                                </span>
                            </div>
                            <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                                {stageLeads.map(lead => (
                                    <div key={lead.id} style={{ background: 'white', borderRadius: '6px', padding: '16px', border: '1px solid var(--gray-200)', cursor: 'pointer' }}>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
                                            <div style={{ fontWeight: '600', fontSize: '14px' }}>{lead.name}</div>
                                            <div style={{ display: 'flex', gap: '4px' }}>
                                                <button className="btn btn-icon" onClick={(e) => { e.stopPropagation(); handleEdit(lead); }}>
                                                    <Icons.Edit />
                                                </button>
                                                {user.permissions?.delete && (
                                                    <button className="btn btn-icon" style={{ color: 'var(--danger)' }} onClick={(e) => { e.stopPropagation(); handleDelete(lead); }}>
                                                        <Icons.Trash />
                                                    </button>
                                                )}
                                            </div>
                                        </div>
                                        <div style={{ fontSize: '13px', color: 'var(--text-secondary)', marginBottom: '8px' }}>{lead.company}</div>
                                        <div style={{ fontSize: '12px', color: 'var(--text-secondary)' }}>
                                            {lead.assignee ? `Assigned: ${lead.assignee}` : 'Unassigned'}
                                        </div>
                                    </div>
                                ))}
                                {stageLeads.length === 0 && (
                                    <div style={{ textAlign: 'center', padding: '20px', color: 'var(--text-secondary)', fontSize: '13px' }}>
                                        No leads in this stage
                                    </div>
                                )}
                            </div>
                        </div>
                    );
                })}
            </div>
        );
    };

    // MODIFY THE RETURN STATEMENT
    return (
        <>
            {/* ADD TABS */}
            <div className="tabs">
                <button className={`tab ${viewMode === 'table' ? 'active' : ''}`} onClick={() => setViewMode('table')}>
                    <Icons.List /> Table View
                </button>
                <button className={`tab ${viewMode === 'kanban' ? 'active' : ''}`} onClick={() => setViewMode('kanban')}>
                    <Icons.Grid /> Kanban Board
                </button>
            </div>

            {/* CONDITIONAL RENDER */}
            {viewMode === 'kanban' ? (
                renderKanban()
            ) : (
                <div className="table-card">
                    {/* EXISTING TABLE CODE */}
                    <div className="table-header">
                        <div className="table-title">All Leads ({leads.length})</div>
                        <div className="table-actions">
                            <button className="btn btn-primary btn-sm" onClick={handleAdd}>
                                <Icons.Plus /> Add Lead
                            </button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Company</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Status</th>
                                <th>Assignee</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {leads.map((lead, idx) => (
                                <tr key={idx}>
                                    <td>{lead.name}</td>
                                    <td>{lead.company}</td>
                                    <td>{lead.email}</td>
                                    <td>{lead.phone}</td>
                                    <td><span className={`badge badge-${lead.status?.toLowerCase()}`}>{lead.status}</span></td>
                                    <td>{lead.assignee}</td>
                                    <td>
                                        <button className="btn btn-icon" onClick={() => handleEdit(lead)}>
                                            <Icons.Edit />
                                        </button>
                                        {user.permissions?.delete && (
                                            <button className="btn btn-icon" style={{ color: 'var(--danger)' }} onClick={() => handleDelete(lead)}>
                                                <Icons.Trash />
                                            </button>
                                        )}
                                    </td>
                                </tr>
                            ))}
                            {leads.length === 0 && (
                                <tr>
                                    <td colSpan="7" className="empty-state">
                                        <div className="empty-state-text">No leads yet</div>
                                        <button className="btn btn-primary" onClick={handleAdd} style={{ marginTop: '16px' }}>
                                            <Icons.Plus /> Add Your First Lead
                                        </button>
                                    </td>
                                </tr>
                            )}
                        </tbody>
                    </table>
                </div>
            )}

            {/* EXISTING MODAL CODE */}
    {showModal && (
                        <div className="modal-overlay" onClick={() => setShowModal(false)}>
                            <div className="modal" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <div className="modal-title">{editingLead ? 'Edit Lead' : 'Add New Lead'}</div>
                                    <button className="close-btn" onClick={() => setShowModal(false)}>√ó</button>
                                </div>
                                <form onSubmit={handleSubmit}>
                                    <div className="modal-body">
                                        <div className="form-group">
                                            <label className="form-label">Name *</label>
                                            <input
                                                type="text"
                                                className="form-input"
                                                value={formData.Name}
                                                onChange={(e) => setFormData({...formData, Name: e.target.value})}
                                                required
                                            />
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">Email *</label>
                                            <input
                                                type="email"
                                                className="form-input"
                                                value={formData.Email}
                                                onChange={(e) => setFormData({...formData, Email: e.target.value})}
                                                required
                                            />
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">Phone</label>
                                            <input
                                                type="tel"
                                                className="form-input"
                                                value={formData.Phone}
                                                onChange={(e) => setFormData({...formData, Phone: e.target.value})}
                                            />
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">Company</label>
                                            <input
                                                type="text"
                                                className="form-input"
                                                value={formData.Company}
                                                onChange={(e) => setFormData({...formData, Company: e.target.value})}
                                            />
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">Status</label>
                                            <select
                                                className="form-input"
                                                value={formData.Status}
                                                onChange={(e) => setFormData({...formData, Status: e.target.value})}
                                            >
                                                <option>New</option>
                                                <option>Contacted</option>
                                                <option>Qualified</option>
                                                <option>Won</option>
                                                <option>Lost</option>
                                            </select>
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">Source</label>
                                            <select
                                                className="form-input"
                                                value={formData.Source}
                                                onChange={(e) => setFormData({...formData, Source: e.target.value})}
                                            >
                                                <option value="">Select source</option>
                                                <option>Website</option>
                                                <option>Referral</option>
                                                <option>Social Media</option>
                                                <option>Cold Call</option>
                                            </select>
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">Assignee *</label>
                                            <select
                                                className="form-input"
                                                value={formData.Assignee}
                                                onChange={(e) => setFormData({...formData, Assignee: e.target.value})}
                                                required
                                            >
                                                <option value="">Select Assignee</option>
                                                {users.map((u, idx) => (
                                                    <option key={idx} value={u.fullName}>
                                                        {u.fullName} ({u.role})
                                                    </option>
                                                ))}
                                            </select>
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">Notes</label>
                                            <textarea
                                                className="form-input"
                                                value={formData.Notes}
                                                onChange={(e) => setFormData({...formData, Notes: e.target.value})}
                                            ></textarea>
                                        </div>
                                    </div>
                                    <div className="modal-footer">
                                        <button type="button" className="btn btn-secondary" onClick={() => setShowModal(false)}>
                                            Cancel
                                        </button>
                                        <button type="submit" className="btn btn-primary" disabled={saving}>
                                            {saving ? 'Saving...' : (editingLead ? 'Update' : 'Add Lead')}
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </>
            );
        };


               
    try {
        if (editingLead) {
            await api.updateLead({
                id: editingLead.id,
                name: formData.Name,      // Changed from Name to name
                email: formData.Email,    // etc.
                phone: formData.Phone,
                company: formData.Company,
                status: formData.Status,
                source: formData.Source,
                assignedTo: formData.Assignee,
                notes: formData.Notes,
                createdDate: editingLead.createdDate
            });
            showToast('Lead updated successfully', 'success');
        } else {
            await api.addLead({
                name: formData.Name,
                email: formData.Email,
                phone: formData.Phone,
                company: formData.Company,
                status: formData.Status,
                source: formData.Source,
                assignedTo: formData.Assignee,
                notes: formData.Notes,
                createdBy: user.username
            });
            showToast('Lead added successfully', 'success');
        }
        setShowModal(false);
        onRefresh();
    } catch (error) {
        showToast(error.message, 'error');
    } finally {
        setSaving(false);
    }
};

            return (
                <>
                    <div className="table-card">
                        <div className="table-header">
                            <div className="table-title">All Leads ({leads.length})</div>
                            <div className="table-actions">
                                <button className="btn btn-primary btn-sm" onClick={handleAdd}>
                                    <Icons.Plus /> Add Lead
                                </button>
                            </div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Company</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Status</th>
                                    <th>Assignee</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {leads.map((lead, idx) => (
                                    <tr key={idx}>
                                        <td>{lead.name}</td>
                                        <td>{lead.company}</td>
                                        <td>{lead.email}</td>
                                        <td>{lead.phone}</td>
                                        <td><span className={`badge badge-${lead.status?.toLowerCase()}`}>{lead.status}</span></td>
                                        <td>{lead.assignee}</td>
                                        <td>
                                            <button className="btn btn-icon" onClick={() => handleEdit(lead)}>
                                                <Icons.Edit />
                                            </button>
                                        </td>
                                    </tr>
                                ))}
                                {leads.length === 0 && (
                                    <tr>
                                        <td colSpan="7" className="empty-state">
                                            <div className="empty-state-text">No leads yet</div>
                                            <button className="btn btn-primary" onClick={handleAdd} style={{ marginTop: '16px' }}>
                                                <Icons.Plus /> Add Your First Lead
                                            </button>
                                        </td>
                                    </tr>
                                )}
                            </tbody>
                        </table>
                    </div>

                    {showModal && (
                        <div className="modal-overlay" onClick={() => setShowModal(false)}>
                            <div className="modal" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <div className="modal-title">{editingLead ? 'Edit Lead' : 'Add New Lead'}</div>
                                    <button className="close-btn" onClick={() => setShowModal(false)}>√ó</button>
                                </div>
                                <form onSubmit={handleSubmit}>
                                    <div className="modal-body">
                                        <div className="form-group">
                                            <label className="form-label">Name *</label>
                                            <input
                                                type="text"
                                                className="form-input"
                                                value={formData.Name}
                                                onChange={(e) => setFormData({...formData, Name: e.target.value})}
                                                required
                                            />
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">Email *</label>
                                            <input
                                                type="email"
                                                className="form-input"
                                                value={formData.Email}
                                                onChange={(e) => setFormData({...formData, Email: e.target.value})}
                                                required
                                            />
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">Phone</label>
                                            <input
                                                type="tel"
                                                className="form-input"
                                                value={formData.Phone}
                                                onChange={(e) => setFormData({...formData, Phone: e.target.value})}
                                            />
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">Company</label>
                                            <input
                                                type="text"
                                                className="form-input"
                                                value={formData.Company}
                                                onChange={(e) => setFormData({...formData, Company: e.target.value})}
                                            />
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">Status</label>
                                            <select
                                                className="form-input"
                                                value={formData.Status}
                                                onChange={(e) => setFormData({...formData, Status: e.target.value})}
                                            >
                                                <option>New</option>
                                                <option>Contacted</option>
                                                <option>Qualified</option>
                                                <option>Won</option>
                                                <option>Lost</option>
                                            </select>
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">Source</label>
                                            <select
                                                className="form-input"
                                                value={formData.Source}
                                                onChange={(e) => setFormData({...formData, Source: e.target.value})}
                                            >
                                                <option value="">Select source</option>
                                                <option>Website</option>
                                                <option>Referral</option>
                                                <option>Social Media</option>
                                                <option>Cold Call</option>
                                            </select>
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">Assignee *</label>
                                            <select
                                                className="form-input"
                                                value={formData.Assignee}
                                                onChange={(e) => setFormData({...formData, Assignee: e.target.value})}
                                                required
                                            >
                                                <option value="">Select Assignee</option>
                                                {users.map((u, idx) => (
                                                    <option key={idx} value={u.fullName}>
                                                        {u.fullName} ({u.role})
                                                    </option>
                                                ))}
                                            </select>
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">Notes</label>
                                            <textarea
                                                className="form-input"
                                                value={formData.Notes}
                                                onChange={(e) => setFormData({...formData, Notes: e.target.value})}
                                            ></textarea>
                                        </div>
                                    </div>
                                    <div className="modal-footer">
                                        <button type="button" className="btn btn-secondary" onClick={() => setShowModal(false)}>
                                            Cancel
                                        </button>
                                        <button type="submit" className="btn btn-primary" disabled={saving}>
                                            {saving ? 'Saving...' : (editingLead ? 'Update' : 'Add Lead')}
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </>
            );
        };

        // CUSTOMERS VIEW COMPONENT
const CustomersView = ({ customers, users, user, showToast, onRefresh }) => {
    const [showModal, setShowModal] = useState(false);
    const [editingCustomer, setEditingCustomer] = useState(null);
    const [formData, setFormData] = useState({
        name: '',
        company: '',
        email: '',
        phone: '',
        address: '',
        city: '',
        country: '',
        industry: '',
        notes: ''
    });
    const [saving, setSaving] = useState(false);

    const handleAdd = () => {
        setEditingCustomer(null);
        setFormData({
            name: '',
            company: '',
            email: '',
            phone: '',
            address: '',
            city: '',
            country: '',
            industry: '',
            notes: ''
        });
        setShowModal(true);
    };

    const handleEdit = (customer) => {
        setEditingCustomer(customer);
        setFormData({
            name: customer.name,
            company: customer.company,
            email: customer.email,
            phone: customer.phone,
            address: customer.address || '',
            city: customer.city || '',
            country: customer.country || '',
            industry: customer.industry || '',
            notes: customer.notes || ''
        });
        setShowModal(true);
    };

    const handleDelete = async (customer) => {
    if (!user.permissions?.delete) {
        showToast('You do not have permission to delete', 'error');
        return;
    }
    
    if (!confirm(`Delete customer "${customer.name}"?`)) return;
    
    try {
        await api.deleteCustomer({ id: customer.id, userRole: user.role });
        showToast('Customer deleted successfully', 'success');
        onRefresh();
    } catch (error) {
        showToast(error.message, 'error');
    }
};

    const handleSubmit = async (e) => {
        e.preventDefault();
        setSaving(true);

        try {
            if (editingCustomer) {
                await api.updateCustomer({
                    ...formData,
                    id: editingCustomer.id,
                    createdBy: editingCustomer.createdBy,
                    createdDate: editingCustomer.createdDate
                });
                showToast('Customer updated successfully', 'success');
            } else {
                await api.addCustomer({
                    ...formData,
                    createdBy: user.username
                });
                showToast('Customer added successfully', 'success');
            }
            setShowModal(false);
            onRefresh();
        } catch (error) {
            showToast(error.message, 'error');
        } finally {
            setSaving(false);
        }
    };

    return (
        <>
            <div className="table-card">
                <div className="table-header">
                    <div className="table-title">All Customers ({customers.length})</div>
                    <div className="table-actions">
                        <button className="btn btn-primary btn-sm" onClick={handleAdd}>
                            <Icons.Plus /> Add Customer
                        </button>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Company</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>City</th>
                            <th>Industry</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {customers.map((customer, idx) => (
                            <tr key={idx}>
                                <td>{customer.name}</td>
                                <td>{customer.company}</td>
                                <td>{customer.email}</td>
                                <td>{customer.phone}</td>
                                <td>{customer.city}</td>
                                <td>{customer.industry}</td>
                                <td><span className={`badge badge-${customer.status?.toLowerCase() || 'active'}`}>{customer.status || 'Active'}</span></td>
                                <td>
                                    <button className="btn btn-icon" onClick={() => handleEdit(customer)}>
                                        <Icons.Edit />
                                    </button>
                                </td>
                            </tr>
                        ))}
                        {customers.length === 0 && (
                            <tr>
                                <td colSpan="8" className="empty-state">
                                    <div className="empty-state-text">No customers yet</div>
                                    <button className="btn btn-primary" onClick={handleAdd} style={{ marginTop: '16px' }}>
                                        <Icons.Plus /> Add Your First Customer
                                    </button>
                                </td>

                                <td>
    <button className="btn btn-icon" onClick={() => handleEdit(customer)}>
        <Icons.Edit />
    </button>
    {user.permissions?.delete && (
        <button className="btn btn-icon" style={{ color: 'var(--danger)' }} onClick={() => handleDelete(customer)}>
            <Icons.Trash />
        </button>
    )}
</td>
                            </tr>
                        )}
                    </tbody>
                </table>
            </div>

            {showModal && (
                <div className="modal-overlay" onClick={() => setShowModal(false)}>
                    <div className="modal" onClick={(e) => e.stopPropagation()}>
                        <div className="modal-header">
                            <div className="modal-title">{editingCustomer ? 'Edit Customer' : 'Add New Customer'}</div>
                            <button className="close-btn" onClick={() => setShowModal(false)}>√ó</button>
                        </div>
                        <form onSubmit={handleSubmit}>
                            <div className="modal-body">
                                <div className="form-row">
                                    <div className="form-group">
                                        <label className="form-label">Name *</label>
                                        <input type="text" className="form-input" value={formData.name} onChange={(e) => setFormData({...formData, name: e.target.value})} required />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">Company *</label>
                                        <input type="text" className="form-input" value={formData.company} onChange={(e) => setFormData({...formData, company: e.target.value})} required />
                                    </div>
                                </div>
                                <div className="form-row">
                                    <div className="form-group">
                                        <label className="form-label">Email *</label>
                                        <input type="email" className="form-input" value={formData.email} onChange={(e) => setFormData({...formData, email: e.target.value})} required />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">Phone</label>
                                        <input type="tel" className="form-input" value={formData.phone} onChange={(e) => setFormData({...formData, phone: e.target.value})} />
                                    </div>
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Address</label>
                                    <input type="text" className="form-input" value={formData.address} onChange={(e) => setFormData({...formData, address: e.target.value})} />
                                </div>
                                <div className="form-row">
                                    <div className="form-group">
                                        <label className="form-label">City</label>
                                        <input type="text" className="form-input" value={formData.city} onChange={(e) => setFormData({...formData, city: e.target.value})} />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">Country</label>
                                        <input type="text" className="form-input" value={formData.country} onChange={(e) => setFormData({...formData, country: e.target.value})} />
                                    </div>
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Industry</label>
                                    <input type="text" className="form-input" value={formData.industry} onChange={(e) => setFormData({...formData, industry: e.target.value})} placeholder="e.g., Technology, Healthcare" />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Notes</label>
                                    <textarea className="form-input" value={formData.notes} onChange={(e) => setFormData({...formData, notes: e.target.value})}></textarea>
                                </div>
                            </div>
                            <div className="modal-footer">
                                <button type="button" className="btn btn-secondary" onClick={() => setShowModal(false)}>Cancel</button>
                                <button type="submit" className="btn btn-primary" disabled={saving}>
                                    {saving ? 'Saving...' : (editingCustomer ? 'Update' : 'Add Customer')}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            )}
        </>
    );
};

const ActivitiesView = ({ activities, users, leads, user, showToast, onRefresh }) => {
    const [showModal, setShowModal] = useState(false);
    const [editingActivity, setEditingActivity] = useState(null);
    const [activeFilter, setActiveFilter] = useState('All');
    const [viewMode, setViewMode] = useState('table'); // 'table' or 'cards'
    const [formData, setFormData] = useState({
        type: 'Call',
        subject: '',
        date: new Date().toISOString().slice(0, 16),
        time: '',
        status: 'Pending',
        assignedTo: '',
        leadId: '',
        notes: ''
    });
    const [saving, setSaving] = useState(false);

    const filteredActivities = activeFilter === 'All' 
        ? activities 
        : activities.filter(a => a.type === activeFilter);

    const handleAdd = () => {
        setEditingActivity(null);
        setFormData({
            type: 'Call',
            subject: '',
            date: new Date().toISOString().slice(0, 16),
            time: '',
            status: 'Pending',
            assignedTo: '',
            leadId: '',
            notes: ''
        });
        setShowModal(true);
    };

    const handleEdit = (activity) => {
        setEditingActivity(activity);
        setFormData({
            type: activity.type || 'Call',
            subject: activity.subject || '',
            date: activity.date || new Date().toISOString().slice(0, 16),
            time: activity.time || '',
            status: activity.status || 'Pending',
            assignedTo: activity.assignedTo || '',
            leadId: activity.leadId || '',
            notes: activity.notes || ''
        });
        setShowModal(true);
    };

    const handleSubmit = async (e) => {
        e.preventDefault();
        setSaving(true);

        try {
            if (editingActivity) {
                await api.updateActivity({
                    ...formData,
                    id: editingActivity.id,
                    createdBy: editingActivity.createdBy,
                    createdDate: editingActivity.createdDate
                });
                showToast('Activity updated', 'success');
            } else {
                await api.addActivity({
                    ...formData,
                    createdBy: user.username
                });
                showToast('Activity added', 'success');
            }
            setShowModal(false);
            onRefresh();
        } catch (error) {
            showToast(error.message, 'error');
        } finally {
            setSaving(false);
        }
    };

    const renderCards = () => (
        <div className="cards-grid">
            {filteredActivities.map((activity, idx) => (
                <div key={idx} className="activity-card">
                    <div className="card-header">
                        <div>
                            <div className="card-title">{activity.subject}</div>
                            <div className="card-subtitle">{activity.type}</div>
                        </div>
                        <div className="card-actions">
                            <button className="btn btn-icon" onClick={() => handleEdit(activity)}>
                                <Icons.Edit />
                            </button>
                        </div>
                    </div>
                    <div className="card-body">
                        <div className="card-detail">
                            <span className="card-detail-label">Date:</span>
                            <span>{formatDateTime(activity.date)}</span>
                        </div>
                        <div className="card-detail">
                            <span className="card-detail-label">Status:</span>
                            <span className={`badge badge-${activity.status?.toLowerCase()}`}>{activity.status}</span>
                        </div>
                        <div className="card-detail">
                            <span className="card-detail-label">Assigned:</span>
                            <span>{activity.assignedTo || 'Unassigned'}</span>
                        </div>
                        {activity.leadId && (
                            <div className="card-detail">
                                <span className="card-detail-label">Lead:</span>
                                <span>{leads.find(l => l.id === activity.leadId)?.name || 'Unknown'}</span>
                            </div>
                        )}
                        {activity.notes && (
                            <div className="card-detail">
                                <span className="card-detail-label">Notes:</span>
                                <span>{activity.notes}</span>
                            </div>
                        )}
                    </div>
                </div>
            ))}
            {filteredActivities.length === 0 && (
                <div className="empty-state" style={{ gridColumn: '1 / -1' }}>
                    <div className="empty-state-text">No activities yet</div>
                    <button className="btn btn-primary" onClick={handleAdd} style={{ marginTop: '16px' }}>
                        <Icons.Plus /> Add Your First Activity
                    </button>
                </div>
            )}
        </div>
    );

    const renderTable = () => (
        <table>
            <thead>
                <tr>
                    <th>Type</th>
                    <th>Subject</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Assigned To</th>
                    <th>Lead</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {filteredActivities.map((activity, idx) => (
                    <tr key={idx}>
                        <td><span className={`badge badge-${activity.type?.toLowerCase()}`}>{activity.type}</span></td>
                        <td>{activity.subject}</td>
                        <td>{formatDateTime(activity.date)}</td>
                        <td><span className={`badge badge-${activity.status?.toLowerCase()}`}>{activity.status}</span></td>
                        <td>{activity.assignedTo || 'Unassigned'}</td>
                        <td>{activity.leadId ? (leads.find(l => l.id === activity.leadId)?.name || 'Unknown') : '-'}</td>
                        <td>
                            <button className="btn btn-icon" onClick={() => handleEdit(activity)}>
                                <Icons.Edit />
                            </button>
                        </td>
                    </tr>
                ))}
                {filteredActivities.length === 0 && (
                    <tr>
                        <td colSpan="7" className="empty-state">
                            <div className="empty-state-text">No activities yet</div>
                            <button className="btn btn-primary" onClick={handleAdd} style={{ marginTop: '16px' }}>
                                <Icons.Plus /> Add Your First Activity
                            </button>
                        </td>
                    </tr>
                )}
            </tbody>
        </table>
    );

    return (
        <>
            <div className="tabs">
                {['All', 'Call', 'Meeting', 'Email'].map(tab => (
                    <button
                        key={tab}
                        className={`tab ${activeFilter === tab ? 'active' : ''}`}
                        onClick={() => setActiveFilter(tab)}
                    >
                        {tab} ({tab === 'All' ? activities.length : activities.filter(a => a.type === tab).length})
                    </button>
                ))}
            </div>

            <div className="table-card">
                <div className="table-header">
                    <div className="table-title">Activity Log</div>
                    <div className="table-actions">
                        <div className="view-toggle">
                            <button 
                                className={viewMode === 'cards' ? 'active' : ''}
                                onClick={() => setViewMode('cards')}
                            >
                                <Icons.Grid /> Cards
                            </button>
                            <button 
                                className={viewMode === 'table' ? 'active' : ''}
                                onClick={() => setViewMode('table')}
                            >
                                <Icons.List /> Table
                            </button>
                        </div>
                        <button className="btn btn-primary btn-sm" onClick={handleAdd}>
                            <Icons.Plus /> Log Activity
                        </button>
                    </div>
                </div>
                {viewMode === 'cards' ? renderCards() : renderTable()}
            </div>

            {showModal && (
                <div className="modal-overlay" onClick={() => setShowModal(false)}>
                    <div className="modal" onClick={(e) => e.stopPropagation()}>
                        <div className="modal-header">
                            <div className="modal-title">{editingActivity ? 'Edit Activity' : 'Log Activity'}</div>
                            <button className="close-btn" onClick={() => setShowModal(false)}>√ó</button>
                        </div>
                        <form onSubmit={handleSubmit}>
                            <div className="modal-body">
                                <div className="form-group">
                                    <label className="form-label">Type *</label>
                                    <select className="form-input" value={formData.type} onChange={(e) => setFormData({...formData, type: e.target.value})} required>
                                        <option>Call</option>
                                        <option>Meeting</option>
                                        <option>Email</option>
                                    </select>
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Subject *</label>
                                    <input type="text" className="form-input" value={formData.subject} onChange={(e) => setFormData({...formData, subject: e.target.value})} required />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Date & Time *</label>
                                    <input type="datetime-local" className="form-input" value={formData.date} onChange={(e) => setFormData({...formData, date: e.target.value})} required />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Status *</label>
                                    <select className="form-input" value={formData.status} onChange={(e) => setFormData({...formData, status: e.target.value})} required>
                                        <option>Pending</option>
                                        <option>Completed</option>
                                        <option>Cancelled</option>
                                    </select>
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Assign To</label>
                                    <select className="form-input" value={formData.assignedTo} onChange={(e) => setFormData({...formData, assignedTo: e.target.value})}>
                                        <option value="">Select Assignee</option>
                                        {users && users.map((u, idx) => (
                                            <option key={idx} value={u.username}>{u.fullName}</option>
                                        ))}
                                    </select>
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Link to Lead</label>
                                    <select className="form-input" value={formData.leadId} onChange={(e) => setFormData({...formData, leadId: e.target.value})}>
                                        <option value="">None</option>
                                        {leads && leads.map((l, idx) => (
                                            <option key={idx} value={l.id}>{l.name} - {l.company}</option>
                                        ))}
                                    </select>
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Notes</label>
                                    <textarea className="form-input" value={formData.notes} onChange={(e) => setFormData({...formData, notes: e.target.value})}></textarea>
                                </div>
                            </div>
                            <div className="modal-footer">
                                <button type="button" className="btn btn-secondary" onClick={() => setShowModal(false)}>Cancel</button>
                                <button type="submit" className="btn btn-primary" disabled={saving}>
                                    {saving ? 'Saving...' : (editingActivity ? 'Update' : 'Log')}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            )}
        </>
    );
};

        // FOLLOW-UPS VIEW - COMPLETE IMPLEMENTATION
const FollowUpsView = ({ followUps, users, leads, user, showToast, onRefresh }) => {
    const [showModal, setShowModal] = useState(false);
    const [editingFollowUp, setEditingFollowUp] = useState(null);
    const [viewMode, setViewMode] = useState('table');
    const [formData, setFormData] = useState({
        clientName: '',
        dueDate: new Date().toISOString().slice(0, 16),
        objective: '',
        priority: 'Medium',
        status: 'Pending',
        assignedTo: '',
        leadId: '',
        notes: ''
    });
    const [saving, setSaving] = useState(false);

    const overdueCount = followUps.filter(f => 
        f.status === 'Pending' && new Date(f.dueDate || f.date) < new Date()
    ).length;

    const handleAdd = () => {
        setEditingFollowUp(null);
        setFormData({
            clientName: '',
            dueDate: new Date().toISOString().slice(0, 16),
            objective: '',
            priority: 'Medium',
            status: 'Pending',
            assignedTo: '',
            leadId: '',
            notes: ''
        });
        setShowModal(true);
    };

    const handleEdit = (followUp) => {
        setEditingFollowUp(followUp);
        setFormData({
            clientName: followUp.clientName || followUp.client_name || '',
            dueDate: followUp.dueDate || followUp.date || new Date().toISOString().slice(0, 16),
            objective: followUp.objective || '',
            priority: followUp.priority || 'Medium',
            status: followUp.status || 'Pending',
            assignedTo: followUp.assignedTo || '',
            leadId: followUp.leadId || '',
            notes: followUp.notes || ''
        });
        setShowModal(true);
    };

    const handleSubmit = async (e) => {
        e.preventDefault();
        setSaving(true);

        try {
            if (editingFollowUp) {
                await api.updateFollowUp({
                    ...formData,
                    id: editingFollowUp.id,
                    createdBy: editingFollowUp.createdBy,
                    createdDate: editingFollowUp.createdDate
                });
                showToast('Follow-up updated', 'success');
            } else {
                await api.addFollowUp({
                    ...formData,
                    createdBy: user.username
                });
                showToast('Follow-up added', 'success');
            }
            setShowModal(false);
            onRefresh();
        } catch (error) {
            showToast(error.message, 'error');
        } finally {
            setSaving(false);
        }
    };

    const renderCards = () => (
        <div className="cards-grid">
            {followUps.map((followUp, idx) => {
                const isOverdue = followUp.status === 'Pending' && 
                    new Date(followUp.dueDate || followUp.date) < new Date();
                
                return (
                    <div key={idx} className="followup-card" 
                        style={{ background: isOverdue ? 'rgba(217, 83, 79, 0.05)' : 'white' }}>
                        <div className="card-header">
                            <div>
                                <div className="card-title">{followUp.clientName || followUp.client_name}</div>
                                <div className="card-subtitle">{followUp.objective}</div>
                            </div>
                            <div className="card-actions">
                                <button className="btn btn-icon" onClick={() => handleEdit(followUp)}>
                                    <Icons.Edit />
                                </button>
                            </div>
                        </div>
                        <div className="card-body">
                            <div className="card-detail">
                                <span className="card-detail-label">Due Date:</span>
                                <span>
                                    {formatDateTime(followUp.dueDate || followUp.date)}
                                    {isOverdue && <span style={{color: 'var(--danger)', marginLeft: '8px', fontWeight: '600'}}>OVERDUE</span>}
                                </span>
                            </div>
                            <div className="card-detail">
                                <span className="card-detail-label">Priority:</span>
                                <span className={`badge badge-${followUp.priority?.toLowerCase()}`}>{followUp.priority}</span>
                            </div>
                            <div className="card-detail">
                                <span className="card-detail-label">Status:</span>
                                <span className={`badge badge-${followUp.status?.toLowerCase()}`}>{followUp.status}</span>
                            </div>
                            <div className="card-detail">
                                <span className="card-detail-label">Assigned:</span>
                                <span>{followUp.assignedTo || 'Unassigned'}</span>
                            </div>
                            {followUp.leadId && (
                                <div className="card-detail">
                                    <span className="card-detail-label">Lead:</span>
                                    <span>{leads.find(l => l.id === followUp.leadId)?.name || 'Unknown'}</span>
                                </div>
                            )}
                            {followUp.notes && (
                                <div className="card-detail">
                                    <span className="card-detail-label">Notes:</span>
                                    <span>{followUp.notes}</span>
                                </div>
                            )}
                        </div>
                    </div>
                );
            })}
            {followUps.length === 0 && (
                <div className="empty-state" style={{ gridColumn: '1 / -1' }}>
                    <div className="empty-state-text">No follow-ups scheduled</div>
                    <button className="btn btn-primary" onClick={handleAdd} style={{ marginTop: '16px' }}>
                        <Icons.Plus /> Schedule Your First Follow-up
                    </button>
                </div>
            )}
        </div>
    );

    const renderTable = () => (
        <table>
            <thead>
                <tr>
                    <th>Client</th>
                    <th>Due Date</th>
                    <th>Objective</th>
                    <th>Priority</th>
                    <th>Status</th>
                    <th>Assigned To</th>
                    <th>Lead</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {followUps.map((followUp, idx) => {
                    const isOverdue = followUp.status === 'Pending' && 
                        new Date(followUp.dueDate || followUp.date) < new Date();
                    
                    return (
                        <tr key={idx} style={{ background: isOverdue ? 'rgba(217, 83, 79, 0.05)' : 'transparent' }}>
                            <td>{followUp.clientName || followUp.client_name}</td>
                            <td>
                                {formatDateTime(followUp.dueDate || followUp.date)}
                                {isOverdue && <span style={{color: 'var(--danger)', marginLeft: '8px', fontWeight: '600'}}>OVERDUE</span>}
                            </td>
                            <td>{followUp.objective}</td>
                            <td><span className={`badge badge-${followUp.priority?.toLowerCase()}`}>{followUp.priority}</span></td>
                            <td><span className={`badge badge-${followUp.status?.toLowerCase()}`}>{followUp.status}</span></td>
                            <td>{followUp.assignedTo || 'Unassigned'}</td>
                            <td>{followUp.leadId ? (leads.find(l => l.id === followUp.leadId)?.name || 'Unknown') : '-'}</td>
                            <td>
                                <button className="btn btn-icon" onClick={() => handleEdit(followUp)}>
                                    <Icons.Edit />
                                </button>
                            </td>
                        </tr>
                    );
                })}
                {followUps.length === 0 && (
                    <tr>
                        <td colSpan="8" className="empty-state">
                            <div className="empty-state-text">No follow-ups scheduled</div>
                            <button className="btn btn-primary" onClick={handleAdd} style={{ marginTop: '16px' }}>
                                <Icons.Plus /> Schedule Your First Follow-up
                            </button>
                        </td>
                    </tr>
                )}
            </tbody>
        </table>
    );

    return (
        <>
            {overdueCount > 0 && (
                <div className="alert alert-error" style={{ marginBottom: '20px' }}>
                    <Icons.XCircle />
                    You have {overdueCount} overdue follow-up{overdueCount > 1 ? 's' : ''}!
                </div>
            )}

            <div className="table-card">
                <div className="table-header">
                    <div className="table-title">Follow-ups ({followUps.length})</div>
                    <div className="table-actions">
                        <div className="view-toggle">
                            <button 
                                className={viewMode === 'cards' ? 'active' : ''}
                                onClick={() => setViewMode('cards')}
                            >
                                <Icons.Grid /> Cards
                            </button>
                            <button 
                                className={viewMode === 'table' ? 'active' : ''}
                                onClick={() => setViewMode('table')}
                            >
                                <Icons.List /> Table
                            </button>
                        </div>
                        <button className="btn btn-primary btn-sm" onClick={handleAdd}>
                            <Icons.Plus /> Schedule Follow-up
                        </button>
                    </div>
                </div>
                {viewMode === 'cards' ? renderCards() : renderTable()}
            </div>

            {showModal && (
                <div className="modal-overlay" onClick={() => setShowModal(false)}>
                    <div className="modal" onClick={(e) => e.stopPropagation()}>
                        <div className="modal-header">
                            <div className="modal-title">{editingFollowUp ? 'Edit Follow-up' : 'Schedule Follow-up'}</div>
                            <button className="close-btn" onClick={() => setShowModal(false)}>√ó</button>
                        </div>
                        <form onSubmit={handleSubmit}>
                            <div className="modal-body">
                                <div className="form-group">
                                    <label className="form-label">Client Name *</label>
                                    <input type="text" className="form-input" value={formData.clientName} onChange={(e) => setFormData({...formData, clientName: e.target.value})} required />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Due Date & Time *</label>
                                    <input type="datetime-local" className="form-input" value={formData.dueDate} onChange={(e) => setFormData({...formData, dueDate: e.target.value})} required />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Objective *</label>
                                    <input type="text" className="form-input" value={formData.objective} onChange={(e) => setFormData({...formData, objective: e.target.value})} placeholder="What do you want to achieve?" required />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Priority *</label>
                                    <select className="form-input" value={formData.priority} onChange={(e) => setFormData({...formData, priority: e.target.value})} required>
                                        <option>High</option>
                                        <option>Medium</option>
                                        <option>Low</option>
                                    </select>
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Status</label>
                                    <select className="form-input" value={formData.status} onChange={(e) => setFormData({...formData, status: e.target.value})}>
                                        <option>Pending</option>
                                        <option>Completed</option>
                                        <option>Cancelled</option>
                                    </select>
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Assign To</label>
                                    <select className="form-input" value={formData.assignedTo} onChange={(e) => setFormData({...formData, assignedTo: e.target.value})}>
                                        <option value="">Select Assignee</option>
                                        {users && users.map((u, idx) => (
                                            <option key={idx} value={u.username}>{u.fullName}</option>
                                        ))}
                                    </select>
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Link to Lead</label>
                                    <select className="form-input" value={formData.leadId} onChange={(e) => setFormData({...formData, leadId: e.target.value})}>
                                        <option value="">None</option>
                                        {leads && leads.map((l, idx) => (
                                            <option key={idx} value={l.id}>{l.name} - {l.company}</option>
                                        ))}
                                    </select>
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Notes</label>
                                    <textarea className="form-input" value={formData.notes} onChange={(e) => setFormData({...formData, notes: e.target.value})}></textarea>
                                </div>
                            </div>
                            <div className="modal-footer">
                                <button type="button" className="btn btn-secondary" onClick={() => setShowModal(false)}>Cancel</button>
                                <button type="submit" className="btn btn-primary" disabled={saving}>
                                    {saving ? 'Saving...' : (editingFollowUp ? 'Update' : 'Schedule')}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            )}
        </>
    );
};

        // ANALYTICS VIEW - COMPLETE IMPLEMENTATION
        const AnalyticsView = ({ data }) => {
            useEffect(() => {
                // Lead Status Chart
                const ctx1 = document.getElementById('leadStatusChart');
                if (ctx1) {
                    const statusCounts = {};
                    data.leads.forEach(l => {
                        statusCounts[l.status] = (statusCounts[l.status] || 0) + 1;
                    });

                    new Chart(ctx1, {
                        type: 'doughnut',
                        data: {
                            labels: Object.keys(statusCounts),
                            datasets: [{
                                data: Object.values(statusCounts),
                                backgroundColor: ['#4A90E2', '#5BC0DE', '#5CB85C', '#F0AD4E', '#D9534F']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { position: 'bottom' }
                            }
                        }
                    });
                }

                // Activity Types Chart
                const ctx2 = document.getElementById('activityTypesChart');
                if (ctx2) {
                    const typeCounts = {};
                    data.activities.forEach(a => {
                        typeCounts[a.type] = (typeCounts[a.type] || 0) + 1;
                    });

                    new Chart(ctx2, {
                        type: 'bar',
                        data: {
                            labels: Object.keys(typeCounts),
                            datasets: [{
                                label: 'Activities',
                                data: Object.values(typeCounts),
                                backgroundColor: '#4A90E2'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false }
                            }
                        }
                    });
                }

                // User Performance Chart
                const ctx3 = document.getElementById('userPerfChart');
                if (ctx3) {
                    const userCounts = {};
                    data.activities.forEach(a => {
                        const name = a.repName || a.rep_name || 'Unknown';
                        userCounts[name] = (userCounts[name] || 0) + 1;
                    });

                    new Chart(ctx3, {
                        type: 'bar',
                        data: {
                            labels: Object.keys(userCounts),
                            datasets: [{
                                label: 'Activities',
                                data: Object.values(userCounts),
                                backgroundColor: '#5CB85C'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            indexAxis: 'y',
                            plugins: {
                                legend: { display: false }
                            }
                        }
                    });
                }
            }, [data]);

            return (
                <>
                    <div className="chart-grid">
                        <div className="chart-card">
                            <div className="chart-header">
                                <div className="chart-title">Lead Status Distribution</div>
                            </div>
                            <div className="chart-container">
                                <canvas id="leadStatusChart"></canvas>
                            </div>
                        </div>

                        <div className="chart-card">
                            <div className="chart-header">
                                <div className="chart-title">Activity Types</div>
                            </div>
                            <div className="chart-container">
                                <canvas id="activityTypesChart"></canvas>
                            </div>
                        </div>

                        <div className="chart-card">
                            <div className="chart-header">
                                <div className="chart-title">User Activity Performance</div>
                            </div>
                            <div className="chart-container">
                                <canvas id="userPerfChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div className="stats-grid">
                        <div className="stat-card">
                            <div className="stat-label">Total Activities</div>
                            <div className="stat-value">{data.activities.length}</div>
                            <div className="stat-footer">
                                <span className="stat-subtext">All time</span>
                            </div>
                        </div>

                        <div className="stat-card">
                            <div className="stat-label">Pending Follow-ups</div>
                            <div className="stat-value">
                                {data.followUps.filter(f => f.status === 'Pending').length}
                            </div>
                            <div className="stat-footer">
                                <span className="stat-subtext">Upcoming</span>
                            </div>
                        </div>

                        <div className="stat-card">
                            <div className="stat-label">Win Rate</div>
                            <div className="stat-value">
                                {data.leads.length > 0 
                                    ? ((data.leads.filter(l => l.status === 'Won').length / data.leads.length) * 100).toFixed(1) 
                                    : 0}%
                            </div>
                            <div className="stat-footer">
                                <span className="stat-subtext">Conversion rate</span>
                            </div>
                        </div>

                        <div className="stat-card">
                            <div className="stat-label">Active Leads</div>
                            <div className="stat-value">
                                {data.leads.filter(l => l.status !== 'Won' && l.status !== 'Lost').length}
                            </div>
                            <div className="stat-footer">
                                <span className="stat-subtext">In pipeline</span>
                            </div>
                        </div>
                    </div>
                </>
            );
        };

        // TEAM VIEW - COMPLETE IMPLEMENTATION
        const TeamView = ({ teamPerformance }) => {
            return (
                <>
                    <div className="stats-grid">
                        {teamPerformance.map((member, idx) => (
                            <div key={idx} className="card stat-card">
                                <div style={{ marginBottom: '16px' }}>
                                    <div style={{ fontSize: '18px', fontWeight: '600', marginBottom: '4px' }}>
                                        {member.name}
                                    </div>
                                    <div style={{ fontSize: '13px', color: 'var(--text-secondary)' }}>
                                        {member.role}
                                    </div>
                                </div>

                                <div style={{ marginBottom: '16px' }}>
                                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
                                        <span style={{ fontSize: '13px', color: 'var(--text-secondary)' }}>Calls Made</span>
                                        <span style={{ fontSize: '14px', fontWeight: '600' }}>
                                            {member.performance.calls} / {member.targets.calls}
                                        </span>
                                    </div>
                                    <div style={{ height: '6px', background: 'var(--gray-200)', borderRadius: '3px', overflow: 'hidden' }}>
                                        <div style={{ 
                                            height: '100%', 
                                            width: `${Math.min((member.performance.calls / member.targets.calls) * 100, 100)}%`,
                                            background: 'linear-gradient(90deg, #4A90E2 0%, #5BC0DE 100%)',
                                            transition: 'width 0.5s'
                                        }}></div>
                                    </div>
                                </div>

                                <div style={{ marginBottom: '16px' }}>
                                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
                                        <span style={{ fontSize: '13px', color: 'var(--text-secondary)' }}>Meetings Held</span>
                                        <span style={{ fontSize: '14px', fontWeight: '600' }}>
                                            {member.performance.meetings} / {member.targets.meetings}
                                        </span>
                                    </div>
                                    <div style={{ height: '6px', background: 'var(--gray-200)', borderRadius: '3px', overflow: 'hidden' }}>
                                        <div style={{ 
                                            height: '100%', 
                                            width: `${Math.min((member.performance.meetings / member.targets.meetings) * 100, 100)}%`,
                                            background: 'linear-gradient(90deg, #5CB85C 0%, #6BB38A 100%)',
                                            transition: 'width 0.5s'
                                        }}></div>
                                    </div>
                                </div>

                                <div>
                                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
                                        <span style={{ fontSize: '13px', color: 'var(--text-secondary)' }}>Deals Closed</span>
                                        <span style={{ fontSize: '14px', fontWeight: '600' }}>
                                            {member.performance.deals} / {member.targets.deals}
                                        </span>
                                    </div>
                                    <div style={{ height: '6px', background: 'var(--gray-200)', borderRadius: '3px', overflow: 'hidden' }}>
                                        <div style={{ 
                                            height: '100%', 
                                            width: `${Math.min((member.performance.deals / member.targets.deals) * 100, 100)}%`,
                                            background: 'linear-gradient(90deg, #F0AD4E 0%, #E8A15D 100%)',
                                            transition: 'width 0.5s'
                                        }}></div>
                                    </div>
                                </div>
                            </div>
                        ))}

                        {teamPerformance.length === 0 && (
                            <div className="empty-state" style={{ gridColumn: '1 / -1' }}>
                                <div className="empty-state-text">No team members found</div>
                            </div>
                        )}
                    </div>
                </>
            );
        };

        // EXPENSES VIEW - SIMPLE IMPLEMENTATION
        const ExpensesView = () => {
            return (
                <div className="alert alert-info">
                    <Icons.InfoCircle />
                    Expenses tracking coming soon! This feature will allow you to track sales-related expenses.
                </div>
            );
        };

        // SETTINGS VIEW - COMPLETE IMPLEMENTATION
        const SettingsView = ({ user, showToast }) => {
            return (
                <>
                    <div className="table-card">
                        <div className="table-header">
                            <div className="table-title">Account Settings</div>
                        </div>
                        <div style={{ padding: '24px' }}>
                            <div style={{ marginBottom: '24px' }}>
                                <h3 style={{ marginBottom: '16px', fontSize: '16px', fontWeight: '600' }}>User Information</h3>
                                <div style={{ display: 'grid', gap: '16px' }}>
                                    <div>
                                        <div style={{ fontSize: '13px', color: 'var(--text-secondary)', marginBottom: '4px' }}>Full Name</div>
                                        <div style={{ fontSize: '15px', fontWeight: '500' }}>{user.fullName}</div>
                                    </div>
                                    <div>
                                        <div style={{ fontSize: '13px', color: 'var(--text-secondary)', marginBottom: '4px' }}>Username</div>
                                        <div style={{ fontSize: '15px', fontWeight: '500' }}>{user.username}</div>
                                    </div>
                                    <div>
                                        <div style={{ fontSize: '13px', color: 'var(--text-secondary)', marginBottom: '4px' }}>Role</div>
                                        <div><span className={`badge badge-${user.role}`}>{user.role}</span></div>
                                    </div>
                                    <div>
                                        <div style={{ fontSize: '13px', color: 'var(--text-secondary)', marginBottom: '4px' }}>Email</div>
                                        <div style={{ fontSize: '15px', fontWeight: '500' }}>{user.email}</div>
                                    </div>
                                </div>
                            </div>

                            <div style={{ marginBottom: '24px', paddingTop: '24px', borderTop: '1px solid var(--gray-200)' }}>
                                <h3 style={{ marginBottom: '16px', fontSize: '16px', fontWeight: '600' }}>Session Information</h3>
                                <div className="alert alert-info">
                                    <Icons.InfoCircle />
                                    Your session will automatically expire after 24 hours for security purposes.
                                </div>
                            </div>

                            <div style={{ paddingTop: '24px', borderTop: '1px solid var(--gray-200)' }}>
                                <h3 style={{ marginBottom: '16px', fontSize: '16px', fontWeight: '600' }}>System Information</h3>
                                <div style={{ display: 'grid', gap: '12px', fontSize: '14px' }}>
                                    <div>‚Ä¢ Auto-refresh: Every 30 seconds</div>
                                    <div>‚Ä¢ Session timeout: 24 hours</div>
                                    <div>‚Ä¢ Version: 3.0 (Zoho Theme)</div>
                                    <div>‚Ä¢ Platform: Darex SalesPulse</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </>
            );
        };

        // Main App
        const App = () => {
            const [user, setUser] = useState(null);
            const [toasts, setToasts] = useState([]);

            useEffect(() => {
                const savedUser = SessionManager.getSession();
                if (savedUser) {
                    setUser(savedUser);
                }
            }, []);

            const showToast = (message, type = 'info') => {
                const id = Date.now();
                setToasts(prev => [...prev, { id, message, type }]);
            };

            const removeToast = (id) => {
                setToasts(prev => prev.filter(t => t.id !== id));
            };

            const handleLogout = () => {
                SessionManager.clearSession();
                setUser(null);
            };

            return (
                <>
                    {!user ? (
                        <Login onLogin={setUser} />
                    ) : (
                        <Dashboard user={user} onLogout={handleLogout} showToast={showToast} />
                    )}
                    <ToastContainer toasts={toasts} removeToast={removeToast} />
                </>
            );
        };

       const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(<App />);
    </script>
</body>
</html>
